<!doctype html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="utf-8">
  <title>stream | Node.js API &#x6587;&#x6863;</title>
  <link rel="stylesheet" href="/static/api.css?20170216">
  <link rel="icon" sizes="32x32" type="image/png" href="/static/favicon.png">
</head>
<body class="alt apidoc" id="api-section-stream">
  <div id="content" class="clearfix">
    <div id="column2" class="interior">
      <div id="intro" class="interior">
        <a href="/">
          Node.js &#x4E2D;&#x6587;&#x7F51;
        </a>
      </div>
      <ul>
<li><a class="nav-documentation" href="documentation.html">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</a></li>
<li><a class="nav-synopsis" href="synopsis.html">&#x7528;&#x6CD5;&#x4E0E;&#x4F8B;&#x5B50;</a></li>
</ul>
<div class="line"></div>

<ul>
<li><a class="nav-assert" href="assert.html">Assert (&#x65AD;&#x8A00;)</a></li>
<li><a class="nav-buffer" href="buffer.html">Buffer</a></li>
<li><a class="nav-addons" href="addons.html">C/C++ &#x63D2;&#x4EF6;</a></li>
<li><a class="nav-child_process" href="child_process.html">Child Processes (&#x5B50;&#x8FDB;&#x7A0B;)</a></li>
<li><a class="nav-cluster" href="cluster.html">Cluster (&#x96C6;&#x7FA4;)</a></li>
<li><a class="nav-cli" href="cli.html">CLI (&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;)</a></li>
<li><a class="nav-console" href="console.html">Console (&#x63A7;&#x5236;&#x53F0;)</a></li>
<li><a class="nav-crypto" href="crypto.html">Crypto (&#x52A0;&#x5BC6;)</a></li>
<li><a class="nav-debugger" href="debugger.html">Debugger (&#x8C03;&#x8BD5;&#x5668;)</a></li>
<li><a class="nav-dns" href="dns.html">DNS (&#x57DF;&#x540D;&#x670D;&#x52A1;&#x5668;)</a></li>
<li><a class="nav-domain" href="domain.html">Domain (&#x57DF;)</a></li>
<li><a class="nav-errors" href="errors.html">Error (&#x9519;&#x8BEF;)</a></li>
<li><a class="nav-events" href="events.html">Events (&#x4E8B;&#x4EF6;)</a></li>
<li><a class="nav-fs" href="fs.html">File System (&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;)</a></li>
<li><a class="nav-globals" href="globals.html">Global (&#x5168;&#x5C40;&#x53D8;&#x91CF;)</a></li>
<li><a class="nav-http" href="http.html">HTTP</a></li>
<li><a class="nav-https" href="https.html">HTTPS</a></li>
<li><a class="nav-modules" href="modules.html">Module (&#x6A21;&#x5757;)</a></li>
<li><a class="nav-net" href="net.html">Net (&#x7F51;&#x7EDC;)</a></li>
<li><a class="nav-os" href="os.html">OS (&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;)</a></li>
<li><a class="nav-path" href="path.html">Path (&#x8DEF;&#x5F84;)</a></li>
<li><a class="nav-process" href="process.html">Process (&#x8FDB;&#x7A0B;)</a></li>
<li><a class="nav-punycode" href="punycode.html">Punycode</a></li>
<li><a class="nav-querystring" href="querystring.html">Query Strings (&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;)</a></li>
<li><a class="nav-readline" href="readline.html">Readline (&#x9010;&#x884C;&#x8BFB;&#x53D6;)</a></li>
<li><a class="nav-repl" href="repl.html">REPL (&#x4EA4;&#x4E92;&#x5F0F;&#x89E3;&#x91CA;&#x5668;)</a></li>
<li><a class="nav-stream active" href="stream.html">Stream (&#x6D41;)</a></li>
<li><a class="nav-string_decoder" href="string_decoder.html">String Decoder (&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x7801;&#x5668;)</a></li>
<li><a class="nav-timers" href="timers.html">Timer (&#x5B9A;&#x65F6;&#x5668;)</a></li>
<li><a class="nav-tls" href="tls.html">TLS/SSL</a></li>
<li><a class="nav-tty" href="tty.html">TTY (&#x7EC8;&#x7AEF;)</a></li>
<li><a class="nav-dgram" href="dgram.html">UDP/Datagram (&#x6570;&#x636E;&#x62A5;)</a></li>
<li><a class="nav-url" href="url.html">URL</a></li>
<li><a class="nav-util" href="util.html">Util (&#x5B9E;&#x7528;&#x5DE5;&#x5177;)</a></li>
<li><a class="nav-v8" href="v8.html">V8</a></li>
<li><a class="nav-vm" href="vm.html">VM (&#x865A;&#x62DF;&#x673A;)</a></li>
<li><a class="nav-zlib" href="zlib.html">ZLIB (&#x538B;&#x7F29;)</a></li>
</ul>
<div class="line"></div>


    </div>

    <div id="column1" data-id="stream" class="interior">
      <header>
        <h1>Node.js v6.10.0 &#x6587;&#x6863;</h1>
        <div id="gtoc">
          <p>
            <a href="/api/" name="toc">&#x8FD4;&#x56DE;&#x6587;&#x6863;&#x9996;&#x9875;</a>
            <!--<a href="/api/all.html">单页面显示</a> |-->
            <!--<a href="/api/stream.json">JSON格式</a> |-->
            <!--<a href="/api/en/stream.html">查看英文版</a>-->
          </p>
        </div>
        <hr>
      </header>

      <div id="toc">
        <h2>&#x76EE;&#x5F55;</h2>
        <ul>
<li><span class="stability_2"><a href="#stream_stream">stream (&#x6D41;)</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_organization_of_this_document">&#x672C;&#x6587;&#x6863;&#x7684;&#x7EC4;&#x7EC7;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_types_of_streams">&#x6D41;&#x7684;&#x7C7B;&#x578B;</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_object_mode">&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_buffering">&#x7F13;&#x51B2;</a></span></li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_api_for_stream_consumers">&#x6D41;&#x6D88;&#x8D39;&#x8005;&#x7684; API</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_writable_streams">&#x53EF;&#x5199;&#x6D41;</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_class_stream_writable">stream.Writable &#x7C7B;</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_event_close">&apos;close&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_drain">&apos;drain&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_error">&apos;error&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_finish">&apos;finish&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_pipe">&apos;pipe&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_unpipe">&apos;unpipe&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_cork">writable.cork()</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_end_chunk_encoding_callback">writable.end([chunk][, encoding][, callback])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_setdefaultencoding_encoding">writable.setDefaultEncoding(encoding)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_uncork">writable.uncork()</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_write_chunk_encoding_callback">writable.write(chunk[, encoding][, callback])</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_readable_streams">&#x53EF;&#x8BFB;&#x6D41;</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_two_modes">&#x4E24;&#x79CD;&#x6A21;&#x5F0F;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_three_states">&#x4E09;&#x79CD;&#x72B6;&#x6001;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_choose_one">&#x9009;&#x62E9;&#x4E00;&#x79CD;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_class_stream_readable">stream.Readable &#x7C7B;</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_event_close_1">&apos;close&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_data">&apos;data&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_end">&apos;end&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_error_1">&apos;error&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_event_readable">&apos;readable&apos; &#x4E8B;&#x4EF6;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_ispaused">readable.isPaused()</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_pause">readable.pause()</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_pipe_destination_options">readable.pipe(destination[, options])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_read_size">readable.read([size])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_resume">readable.resume()</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_setencoding_encoding">readable.setEncoding(encoding)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_unpipe_destination">readable.unpipe([destination])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_unshift_chunk">readable.unshift(chunk)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_wrap_stream">readable.wrap(stream)</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_duplex_and_transform_streams">Duplex &#x6D41;&#x4E0E; Transform &#x6D41;</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_class_stream_duplex">stream.Duplex &#x7C7B;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_class_stream_transform">stream.Transform &#x7C7B;</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_api_for_stream_implementers">API for Stream Implementers</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_simplified_construction">Simplified Construction</a></span></li>
<li><span class="stability_undefined"><a href="#stream_implementing_a_writable_stream">Implementing a Writable Stream</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_constructor_new_stream_writable_options">Constructor: new stream.Writable([options])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_write_chunk_encoding_callback_1">writable._write(chunk, encoding, callback)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_writable_writev_chunks_callback">writable._writev(chunks, callback)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_errors_while_writing">Errors While Writing</a></span></li>
<li><span class="stability_undefined"><a href="#stream_an_example_writable_stream">An Example Writable Stream</a></span></li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_implementing_a_readable_stream">Implementing a Readable Stream</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_new_stream_readable_options">new stream.Readable([options])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_read_size_1">readable._read(size)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_push_chunk_encoding">readable.push(chunk[, encoding])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_errors_while_reading">Errors While Reading</a></span></li>
<li><span class="stability_undefined"><a href="#stream_an_example_counting_stream">An Example Counting Stream</a></span></li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_implementing_a_duplex_stream">Implementing a Duplex Stream</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_new_stream_duplex_options">new stream.Duplex(options)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_an_example_duplex_stream">An Example Duplex Stream</a></span></li>
<li><span class="stability_undefined"><a href="#stream_object_mode_duplex_streams">Object Mode Duplex Streams</a></span></li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_implementing_a_transform_stream">Implementing a Transform Stream</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_new_stream_transform_options">new stream.Transform([options])</a></span></li>
<li><span class="stability_undefined"><a href="#stream_events_finish_and_end">Events: &apos;finish&apos; and &apos;end&apos;</a></span></li>
<li><span class="stability_undefined"><a href="#stream_transform_flush_callback">transform._flush(callback)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_transform_transform_chunk_encoding_callback">transform._transform(chunk, encoding, callback)</a></span></li>
<li><span class="stability_undefined"><a href="#stream_class_stream_passthrough">Class: stream.PassThrough</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="stability_undefined"><a href="#stream_additional_notes">Additional Notes</a></span><ul>
<li><span class="stability_undefined"><a href="#stream_compatibility_with_older_node_js_versions">Compatibility with Older Node.js Versions</a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_read_0"><code>readable.read(0)</code></a></span></li>
<li><span class="stability_undefined"><a href="#stream_readable_push"><code>readable.push(&apos;&apos;)</code></a></span></li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>

      <div id="apicontent">
        <h1>stream (&#x6D41;)<span><a class="mark" href="#stream_stream" id="stream_stream">#</a></span></h1><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<pre class="api_stability api_stability_2">&#x7A33;&#x5B9A;&#x6027;: 2 - &#x7A33;&#x5B9A;&#x7684;</pre><p>&#x6D41;&#xFF08;stream&#xFF09;&#x5728; Node.js &#x4E2D;&#x662F;&#x5904;&#x7406;&#x6D41;&#x6570;&#x636E;&#x7684;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#xFF08;abstract interface&#xFF09;&#x3002;
<code>stream</code> &#x6A21;&#x5757;&#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x7840;&#x7684; API &#x3002;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B; API &#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x6765;&#x6784;&#x5EFA;&#x5B9E;&#x73B0;&#x6D41;&#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<p>Node.js &#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x79CD;&#x6D41;&#x5BF9;&#x8C61;&#x3002; &#x4F8B;&#x5982;&#xFF0C;
<a href="http.html#http_class_http_incomingmessage">HTTP &#x8BF7;&#x6C42;</a> &#x548C; <a href="process.html#process_process_stdout"><code>process.stdout</code></a>
&#x5C31;&#x90FD;&#x662F;&#x6D41;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>
<p>&#x6D41;&#x53EF;&#x4EE5;&#x662F;&#x53EF;&#x8BFB;&#x7684;&#x3001;&#x53EF;&#x5199;&#x7684;&#xFF0C;&#x6216;&#x662F;&#x53EF;&#x8BFB;&#x5199;&#x7684;&#x3002;&#x6240;&#x6709;&#x7684;&#x6D41;&#x90FD;&#x662F;
<a href="events.html#events_class_eventemitter"><code>EventEmitter</code></a> &#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>
<p><code>stream</code> &#x6A21;&#x5757;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x5F15;&#x5165;&#xFF1A;</p>
<pre><code class="lang-js">const stream = require(&apos;stream&apos;);
</code></pre>
<p>&#x5C3D;&#x7BA1;&#x6240;&#x6709;&#x7684; Node.js &#x7528;&#x6237;&#x90FD;&#x5E94;&#x8BE5;&#x7406;&#x89E3;&#x6D41;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x70B9;&#x5F88;&#x91CD;&#x8981;&#xFF0C;
&#x4F46;&#x662F; <code>stream</code> &#x6A21;&#x5757;&#x672C;&#x8EAB;&#x53EA;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x6D41;&#x7684;&#x5B9E;&#x4F8B;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x6700;&#x6709;&#x7528;&#x5904;&#x3002; &#x5BF9;&#x4E8E;&#x4E3B;&#x8981;&#x662F; <em>&#x6D88;&#x8D39;</em> &#x6D41;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x4ED6;&#x4EEC;&#x5F88;&#x5C11;&#xFF08;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF09;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x4F7F;&#x7528;
 <code>stream</code> &#x6A21;&#x5757;&#x3002;</p>
<h2>&#x672C;&#x6587;&#x6863;&#x7684;&#x7EC4;&#x7EC7;<span><a class="mark" href="#stream_organization_of_this_document" id="stream_organization_of_this_document">#</a></span></h2><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_organization_of_this_document">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/organization_of_this_document.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>&#x672C;&#x6587;&#x6863;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E24;&#x8282;&#xFF0C;&#x7B2C;&#x4E09;&#x8282;&#x662F;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#x3002;&#x7B2C;&#x4E00;&#x8282;&#x9610;&#x8FF0;&#x4E86;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x548C; <em>&#x4F7F;&#x7528;</em> &#x6D41;&#x76F8;&#x5173;&#x7684; API &#x3002; &#x7B2C;&#x4E8C;&#x8282;&#x9610;&#x8FF0;&#x4E86;&#x548C; <em>&#x5B9E;&#x73B0;</em> &#x65B0;&#x7684;&#x6D41;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x7684; API &#x3002;</p>
<h2>&#x6D41;&#x7684;&#x7C7B;&#x578B;<span><a class="mark" href="#stream_types_of_streams" id="stream_types_of_streams">#</a></span></h2><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_types_of_streams">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/types_of_streams.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>Node.js &#x4E2D;&#x6709;&#x56DB;&#x79CD;&#x57FA;&#x672C;&#x7684;&#x6D41;&#x7C7B;&#x578B;&#xFF1A;</p>
<ul>
<li><a href="#stream_class_stream_readable">Readable</a> - &#x53EF;&#x8BFB;&#x7684;&#x6D41; (&#x4F8B;&#x5982;
<a href="fs.html#fs_fs_createreadstream_path_options"><code>fs.createReadStream()</code></a>).</li>
<li><a href="#stream_class_stream_writable">Writable</a> - &#x53EF;&#x5199;&#x7684;&#x6D41; (&#x4F8B;&#x5982;
<a href="fs.html#fs_fs_createwritestream_path_options"><code>fs.createWriteStream()</code></a>).</li>
<li><a href="#stream_class_stream_duplex">Duplex</a> - &#x53EF;&#x8BFB;&#x5199;&#x7684;&#x6D41; (&#x4F8B;&#x5982;
<a href="net.html#net_class_net_socket"><code>net.Socket</code></a>).</li>
<li><a href="#stream_class_stream_transform">Transform</a> - &#x5728;&#x8BFB;&#x5199;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x548C;&#x53D8;&#x6362;&#x6570;&#x636E;&#x7684; Duplex &#x6D41;  (&#x4F8B;&#x5982; <a href="zlib.html#zlib_zlib_createdeflate_options"><code>zlib.createDeflate()</code></a>).</li>
</ul>
<h3>&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;<span><a class="mark" href="#stream_object_mode" id="stream_object_mode">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_object_mode">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/object_mode.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>&#x6240;&#x6709;&#x4F7F;&#x7528; Node.js API &#x521B;&#x5EFA;&#x7684;&#x6D41;&#x5BF9;&#x8C61;&#x90FD;&#x53EA;&#x80FD;&#x64CD;&#x4F5C; strings &#x548C; <code>Buffer</code>
&#x5BF9;&#x8C61;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x6D41;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4F60;&#x4F9D;&#x7136;&#x80FD;&#x591F;&#x5904;&#x7406;&#x5176;&#x5B83;&#x7C7B;&#x578B;&#x7684; JavaScript &#x503C; (&#x9664;&#x4E86; <code>null</code>&#xFF0C;&#x5B83;&#x5728;&#x6D41;&#x5904;&#x7406;&#x4E2D;&#x6709;&#x7279;&#x6B8A;&#x610F;&#x4E49;)&#x3002; &#x8FD9;&#x4E9B;&#x6D41;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x5DE5;&#x4F5C;&#x5728; &#x201C;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x201D;&#xFF08;object mode&#xFF09;&#x3002;</p>
<p>&#x5728;&#x521B;&#x5EFA;&#x6D41;&#x7684;&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>objectMode</code> &#x9009;&#x9879;&#x4F7F;&#x6D41;&#x7684;&#x5B9E;&#x4F8B;&#x5207;&#x6362;&#x5230;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x3002;&#x8BD5;&#x56FE;&#x5C06;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x6D41;&#x5207;&#x6362;&#x5230;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x3002;</p>
<h3>&#x7F13;&#x51B2;<span><a class="mark" href="#stream_buffering" id="stream_buffering">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_buffering">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/buffering.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<!--type=misc-->
<p><a href="#stream_class_stream_writable">Writable</a> &#x548C; <a href="#stream_class_stream_readable">Readable</a> &#x6D41;&#x90FD;&#x4F1A;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5230;&#x5185;&#x90E8;&#x7684;&#x7F13;&#x5B58;&#xFF08;buffer&#xFF09;&#x4E2D;&#x3002;&#x8FD9;&#x4E9B;&#x7F13;&#x5B58;&#x53EF;&#x4EE5;
&#x901A;&#x8FC7;&#x76F8;&#x5E94;&#x7684; <code>writable._writableState.getBuffer()</code> &#x6216;
<code>readable._readableState.buffer</code>&#x6765;&#x83B7;&#x53D6;&#x3002;</p>
<p>&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x53D6;&#x51B3;&#x4E8E;&#x4F20;&#x9012;&#x7ED9;&#x6D41;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684; <code>highWaterMark</code> &#x9009;&#x9879;&#x3002;
&#x5BF9;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x6D41;&#xFF0C; <code>highWaterMark</code>
&#x9009;&#x9879;&#x6307;&#x5B9A;&#x4E86;&#x603B;&#x5171;&#x7684;&#x5B57;&#x8282;&#x6570;&#x3002;&#x5BF9;&#x4E8E;&#x5DE5;&#x4F5C;&#x5728;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x7684;&#x6D41;&#xFF0C;
<code>highWaterMark</code> &#x6307;&#x5B9A;&#x4E86;&#x5BF9;&#x8C61;&#x7684;&#x603B;&#x6570;&#x3002;</p>
<p>&#x5F53;&#x53EF;&#x8BFB;&#x6D41;&#x7684;&#x5B9E;&#x73B0;&#x8C03;&#x7528; 
<a href="#stream_readable_push_chunk_encoding"><code>stream.push(chunk)</code></a> &#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x88AB;&#x653E;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x6D41;&#x7684;&#x6D88;&#x8D39;&#x8005;
&#x6CA1;&#x6709;&#x8C03;&#x7528; <a href="#stream_readable_read_size"><code>stream.read()</code></a> &#x65B9;&#x6CD5;&#xFF0C; &#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4F1A;&#x59CB;&#x7EC8;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x90E8;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x76F4;&#x5230;&#x88AB;&#x6D88;&#x8D39;&#x3002;</p>
<p>&#x5F53;&#x5185;&#x90E8;&#x53EF;&#x8BFB;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x8FBE;&#x5230; <code>highWaterMark</code> &#x6307;&#x5B9A;&#x7684;&#x9608;&#x503C;&#x65F6;&#xFF0C;&#x6D41;&#x4F1A;&#x6682;&#x505C;&#x4ECE;&#x5E95;&#x5C42;&#x8D44;&#x6E90;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x76F4;&#x5230;&#x5F53;&#x524D;
&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x88AB;&#x6D88;&#x8D39; (&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;
&#x6D41;&#x4F1A;&#x5728;&#x5185;&#x90E8;&#x505C;&#x6B62;&#x8C03;&#x7528; <code>readable._read()</code> &#x6765;&#x586B;&#x5145;&#x53EF;&#x8BFB;&#x7F13;&#x5B58;)&#x3002;</p>
<p>&#x53EF;&#x5199;&#x6D41;&#x901A;&#x8FC7;&#x53CD;&#x590D;&#x8C03;&#x7528;
<a href="#stream_writable_write_chunk_encoding_callback"><code>writable.write(chunk)</code></a> &#x65B9;&#x6CD5;&#x5C06;&#x6570;&#x636E;&#x653E;&#x5230;&#x7F13;&#x5B58;&#x3002;
&#x5F53;&#x5185;&#x90E8;&#x53EF;&#x5199;&#x7F13;&#x5B58;&#x7684;&#x603B;&#x5927;&#x5C0F;&#x5C0F;&#x4E8E;
<code>highWaterMark</code> &#x6307;&#x5B9A;&#x7684;&#x9608;&#x503C;&#x65F6;&#xFF0C; &#x8C03;&#x7528; <code>writable.write()</code> &#x5C06;&#x8FD4;&#x56DE;<code>true</code>&#x3002; 
&#x4E00;&#x65E6;&#x5185;&#x90E8;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x8FBE;&#x5230;&#x6216;&#x8D85;&#x8FC7; <code>highWaterMark</code> &#xFF0C;&#x8C03;&#x7528; <code>writable.write()</code> &#x5C06;&#x8FD4;&#x56DE; <code>false</code> &#x3002;</p>
<p><code>stream</code> API &#x7684;&#x5173;&#x952E;&#x76EE;&#x6807;&#xFF0C; &#x5C24;&#x5176;&#x5BF9;&#x4E8E; <a href="#stream_readable_pipe_destination_options"><code>stream.pipe()</code></a> &#x65B9;&#x6CD5;&#xFF0C;
&#x5C31;&#x662F;&#x9650;&#x5236;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x5927;&#x5C0F;&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x7A0B;&#x5EA6;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5BF9;&#x4E8E;&#x8BFB;&#x5199;&#x901F;&#x5EA6;&#x4E0D;&#x5339;&#x914D;&#x7684;&#x6E90;&#x5934;&#x548C;&#x76EE;&#x6807;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x8D85;&#x51FA;&#x53EF;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x3002;</p>
<p><a href="#stream_class_stream_duplex">Duplex</a> &#x548C; <a href="#stream_class_stream_transform">Transform</a> &#x90FD;&#x662F;&#x53EF;&#x8BFB;&#x5199;&#x7684;&#x3002;
&#x5728;&#x5185;&#x90E8;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x7EF4;&#x62A4;&#x4E86; <em>&#x4E24;&#x4E2A;</em> &#x76F8;&#x4E92;&#x72EC;&#x7ACB;&#x7684;&#x7F13;&#x5B58;&#x7528;&#x4E8E;&#x8BFB;&#x548C;&#x5199;&#x3002;
&#x5728;&#x7EF4;&#x6301;&#x4E86;&#x5408;&#x7406;&#x9AD8;&#x6548;&#x7684;&#x6570;&#x636E;&#x6D41;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x4E5F;&#x4F7F;&#x5F97;&#x5BF9;&#x4E8E;&#x8BFB;&#x548C;&#x5199;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x8FDB;&#x884C;&#x800C;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x3002;
&#x4F8B;&#x5982;&#xFF0C; <a href="net.html#net_class_net_socket"><code>net.Socket</code></a> &#x5C31;&#x662F; <a href="#stream_class_stream_duplex">Duplex</a> &#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x7684;&#x53EF;&#x8BFB;&#x7AEF;&#x53EF;&#x4EE5;&#x6D88;&#x8D39;&#x4ECE;&#x5957;&#x63A5;&#x5B57;&#xFF08;socket&#xFF09;&#x4E2D;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#xFF0C; 
&#x53EF;&#x5199;&#x7AEF;&#x5219;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x5957;&#x63A5;&#x5B57;&#x3002;
&#x7531;&#x4E8E;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x5957;&#x63A5;&#x5B57;&#x4E2D;&#x7684;&#x901F;&#x5EA6;&#x53EF;&#x80FD;&#x6BD4;&#x4ECE;&#x5957;&#x63A5;&#x5B57;&#x63A5;&#x6536;&#x6570;&#x636E;&#x7684;&#x901F;&#x5EA6;&#x5FEB;&#x6216;&#x8005;&#x6162;&#xFF0C;
&#x5728;&#x8BFB;&#x5199;&#x4E24;&#x7AEF;&#x4F7F;&#x7528;&#x72EC;&#x7ACB;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x72EC;&#x7ACB;&#x64CD;&#x4F5C;&#x5C31;&#x663E;&#x5F97;&#x5F88;&#x91CD;&#x8981;&#x4E86;&#x3002;</p>
<h2>&#x6D41;&#x6D88;&#x8D39;&#x8005;&#x7684; API<span><a class="mark" href="#stream_api_for_stream_consumers" id="stream_api_for_stream_consumers">#</a></span></h2><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_api_for_stream_consumers">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/api_for_stream_consumers.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<!--type=misc-->
<p>&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684; Node.js &#x5E94;&#x7528;&#xFF0C;&#x4E0D;&#x7BA1;&#x591A;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x90FD;&#x5728;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F7F;&#x7528;&#x4E86;&#x6D41;&#x3002;
&#x4E0B;&#x9762;&#x662F;&#x5728; Node.js &#x5E94;&#x7528;&#x4E2D;&#x4F7F;&#x7528;&#x6D41;&#x5B9E;&#x73B0;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; HTTP &#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre><code class="lang-js">const http = require(&apos;http&apos;);

const server = http.createServer( (req, res) =&gt; {
  // req &#x662F; http.IncomingMessage &#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; Readable Stream
  // res &#x662F; http.ServerResponse &#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; Writable Stream

  let body = &apos;&apos;;
  // &#x63A5;&#x6536;&#x6570;&#x636E;&#x4E3A; utf8 &#x5B57;&#x7B26;&#x4E32;&#xFF0C;
  // &#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x5B57;&#x7B26;&#x7F16;&#x7801;&#xFF0C;&#x5C06;&#x63A5;&#x6536;&#x5230; Buffer &#x5BF9;&#x8C61;&#x3002;
  req.setEncoding(&apos;utf8&apos;);

  // &#x5982;&#x679C;&#x76D1;&#x542C;&#x4E86; &apos;data&apos; &#x4E8B;&#x4EF6;&#xFF0C;Readable streams &#x89E6;&#x53D1; &apos;data&apos; &#x4E8B;&#x4EF6; 
  req.on(&apos;data&apos;, (chunk) =&gt; {
    body += chunk;
  });

  // end &#x4E8B;&#x4EF6;&#x8868;&#x660E;&#x6574;&#x4E2A; body &#x90FD;&#x63A5;&#x6536;&#x5B8C;&#x6BD5;&#x4E86; 
  req.on(&apos;end&apos;, () =&gt; {
    try {
      const data = JSON.parse(body);
      // &#x53D1;&#x9001;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#x7ED9;&#x7528;&#x6237;
      res.write(typeof data);
      res.end();
    } catch (er) {
      // json &#x6570;&#x636E;&#x89E3;&#x6790;&#x5931;&#x8D25; 
      res.statusCode = 400;
      return res.end(`error: ${er.message}`);
    }
  });
});

server.listen(1337);

// $ curl localhost:1337 -d &apos;{}&apos;
// object
// $ curl localhost:1337 -d &apos;&quot;foo&quot;&apos;
// string
// $ curl localhost:1337 -d &apos;not json&apos;
// error: Unexpected token o
</code></pre>
<p><a href="#stream_class_stream_writable">Writable</a> &#x6D41; (&#x6BD4;&#x5982;&#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>res</code>) &#x66B4;&#x9732;&#x4E86;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#xFF0C;&#x6BD4;&#x5982;
<code>write()</code> &#x548C; <code>end()</code> &#x3002;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x6D41;&#x4E2D;&#x3002;</p>
<p>&#x5F53;&#x6D41;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;<a href="#stream_class_stream_readable">Readable</a> &#x6D41;&#x4F7F;&#x7528; <a href="events.html#events_class_eventemitter"><code>EventEmitter</code></a> API &#x6765;&#x901A;&#x77E5;&#x5E94;&#x7528;&#x3002;
&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#x4ECE;&#x6D41;&#x4E2D;&#x8BFB;&#x53D6;&#x3002;</p>
<p><a href="#stream_class_stream_writable">Writable</a> &#x548C; <a href="#stream_class_stream_readable">Readable</a> &#x6D41;&#x90FD;&#x4F7F;&#x7528;&#x4E86; <a href="events.html#events_class_eventemitter"><code>EventEmitter</code></a> API &#xFF0C;&#x901A;&#x8FC7;&#x591A;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;
&#x4E0E;&#x6D41;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x3002;</p>
<p><a href="#stream_class_stream_duplex">Duplex</a> &#x548C; <a href="#stream_class_stream_transform">Transform</a> &#x90FD;&#x662F;&#x540C;&#x65F6;&#x6EE1;&#x8DB3; <a href="#stream_class_stream_writable">Writable</a> &#x548C; <a href="#stream_class_stream_readable">Readable</a> &#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x5199;&#x5165;&#x6570;&#x636E;&#x5230;&#x6D41;&#x548C;&#x4ECE;&#x6D41;&#x4E2D;&#x6D88;&#x8D39;&#x6570;&#x636E;&#x7684;&#x5E94;&#x7528;&#x6765;&#x8BF4;&#xFF0C;
&#x4E0D;&#x8981;&#x6C42;&#x76F4;&#x63A5;&#x5B9E;&#x73B0;&#x6D41;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x5E38;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x7528; <code>require(&apos;stream&apos;)</code>&#x3002;</p>
<p>&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x6D41;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="#stream_api_for_stream_implementers">API for Stream Implementers</a>&#x3002;</p>
<h3>&#x53EF;&#x5199;&#x6D41;<span><a class="mark" href="#stream_writable_streams" id="stream_writable_streams">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_streams">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_streams.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>Writable streams &#x662F; <em>destination</em> &#x7684;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#xFF0C;&#x8FD9;&#x79CD; <em>destination</em> &#x5141;&#x8BB8;&#x6570;&#x636E;&#x5199;&#x5165;&#x3002;</p>
<p><a href="#stream_class_stream_writable">Writable</a> &#x7684;&#x4F8B;&#x5B50;&#x5305;&#x62EC;&#x4E86;&#xFF1A;</p>
<ul>
<li><a href="http.html#http_class_http_clientrequest">HTTP requests, on the client</a></li>
<li><a href="http.html#http_class_http_serverresponse">HTTP responses, on the server</a></li>
<li><a href="fs.html#fs_class_fs_writestream">fs write streams</a></li>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
<li><a href="net.html#net_class_net_socket">TCP sockets</a></li>
<li><a href="child_process.html#child_process_child_stdin">child process stdin</a></li>
<li><a href="process.html#process_process_stdout"><code>process.stdout</code></a>, <a href="process.html#process_process_stderr"><code>process.stderr</code></a></li>
</ul>
<p><em>&#x6CE8;&#x610F;</em>: &#x4E0A;&#x9762;&#x7684;&#x67D0;&#x4E9B;&#x4F8B;&#x5B50;&#x4E8B;&#x5B9E;&#x4E0A;&#x662F; <a href="#stream_class_stream_duplex">Duplex</a> &#x6D41;&#xFF0C;&#x53EA;&#x662F;&#x5B9E;&#x73B0;&#x4E86; <a href="#stream_class_stream_writable">Writable</a> &#x63A5;&#x53E3;&#x3002;</p>
<p>&#x6240;&#x6709; <a href="#stream_class_stream_writable">Writable</a> &#x6D41;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;
<code>stream.Writable</code> &#x7C7B;&#x5B9A;&#x4E49;&#x7684;&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x5C3D;&#x7BA1;&#x7279;&#x5B9A;&#x7684; <a href="#stream_class_stream_writable">Writable</a> &#x6D41;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x7565;&#x6709;&#x5DEE;&#x522B;&#xFF0C;
&#x6240;&#x6709;&#x7684; Writable streams &#x90FD;&#x53EF;&#x4EE5;&#x6309;&#x4E00;&#x79CD;&#x57FA;&#x672C;&#x6A21;&#x5F0F;&#x8FDB;&#x884C;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x4F8B;&#x5B50;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-js">const myStream = getWritableStreamSomehow();
myStream.write(&apos;some data&apos;);
myStream.write(&apos;some more data&apos;);
myStream.end(&apos;done writing data&apos;);
</code></pre>
<h4>stream.Writable &#x7C7B;<span><a class="mark" href="#stream_class_stream_writable" id="stream_class_stream_writable">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_class_stream_writable">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/class_stream_writable.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><!--type=class-->
<h5>&apos;close&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_close" id="stream_event_close">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_close">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_close.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><p><code>&apos;close&apos;</code> &#x4E8B;&#x4EF6;&#x5C06;&#x5728;&#x6D41;&#x6216;&#x5176;&#x5E95;&#x5C42;&#x8D44;&#x6E90;&#xFF08;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF09;&#x5173;&#x95ED;&#x540E;&#x89E6;&#x53D1;&#x3002;<code>&apos;close&apos;</code> &#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x540E;&#xFF0C;&#x8BE5;&#x6D41;&#x5C06;&#x4E0D;&#x4F1A;&#x518D;&#x89E6;&#x53D1;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;&#x3002;</p>
<p>&#x4E0D;&#x662F;&#x6240;&#x6709;&#x53EF;&#x5199;&#x6D41;&#x90FD;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;close&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<h5>&apos;drain&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_drain" id="stream_event_drain">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_drain">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_drain.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><p>&#x5982;&#x679C;&#x8C03;&#x7528; <a href="#stream_writable_write_chunk_encoding_callback"><code>stream.write(chunk)</code></a> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE; <code>false</code>&#xFF0C;&#x6D41;&#x5C06;&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x673A;&#x89E6;&#x53D1;
<code>&apos;drain&apos;</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x65F6;&#x624D;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5411;&#x6D41;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#x3002;</p>
<pre><code class="lang-js">// &#x5411;&#x53EF;&#x5199;&#x6D41;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#x4E00;&#x767E;&#x4E07;&#x6B21;&#x3002;
// &#x9700;&#x8981;&#x6CE8;&#x610F;&#x80CC;&#x538B; &#xFF08;back-pressure&#xFF09;&#x3002;
function writeOneMillionTimes(writer, data, encoding, callback) {
  let i = 1000000;
  write();
  function write() {
    var ok = true;
    do {
      i--;
      if (i === 0) {
        // &#x6700;&#x540E; &#x4E00;&#x6B21;
        writer.write(data, encoding, callback);
      } else {
        // &#x68C0;&#x67E5;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5199;&#x5165;&#x3002; 
        // &#x8FD9;&#x91CC;&#x4E0D;&#x8981;&#x4F20;&#x9012; callback&#xFF0C; &#x56E0;&#x4E3A;&#x5199;&#x5165;&#x8FD8;&#x6CA1;&#x6709;&#x7ED3;&#x675F;&#xFF01; 
        ok = writer.write(data, encoding);
      }
    } while (i &gt; 0 &amp;&amp; ok);
    if (i &gt; 0) {
      // &#x8FD9;&#x91CC;&#x63D0;&#x524D;&#x505C;&#x4E0B;&#x4E86;&#xFF0C; 
      // &apos;drain&apos; &#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x540E;&#x624D;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5199;&#x5165;  
      writer.once(&apos;drain&apos;, write);
    }
  }
}
</code></pre>
<h5>&apos;error&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_error" id="stream_event_error">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_error">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_error.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a></li>
</ul>
<p><code>&apos;error&apos;</code> &#x4E8B;&#x4EF6;&#x5728;&#x5199;&#x5165;&#x6570;&#x636E;&#x51FA;&#x9519;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x7BA1;&#x9053;&#x51FA;&#x9519;&#x65F6;&#x89E6;&#x53D1;&#x3002;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x56DE;&#x6389;&#x51FD;&#x6570;&#x4EC5;&#x4F1A;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A; <code>Error</code> &#x53C2;&#x6570;&#x3002;</p>
<p><em>&#x6CE8;&#x610F;</em>: <code>&apos;error&apos;</code> &#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x6D41;&#x5E76;&#x4E0D;&#x4F1A;&#x5173;&#x95ED;&#x3002;</p>
<h5>&apos;finish&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_finish" id="stream_event_finish">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_finish">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_finish.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><p>&#x5728;&#x8C03;&#x7528;&#x4E86; <a href="#stream_writable_end_chunk_encoding_callback"><code>stream.end()</code></a> &#x65B9;&#x6CD5;&#xFF0C;&#x4E14;&#x7F13;&#x51B2;&#x533A;&#x6570;&#x636E;&#x90FD;&#x5DF2;&#x7ECF;&#x4F20;&#x7ED9;&#x5E95;&#x5C42;&#x7CFB;&#x7EDF;&#xFF08;underlying system&#xFF09;&#x4E4B;&#x540E;&#xFF0C; <code>&apos;finish&apos;</code> &#x4E8B;&#x4EF6;&#x5C06;&#x88AB;&#x89E6;&#x53D1;&#x3002;</p>
<pre><code class="lang-js">const writer = getWritableStreamSomehow();
for (var i = 0; i &lt; 100; i ++) {
  writer.write(&apos;hello, #${i}!\n&apos;);
}
writer.end(&apos;This is the end\n&apos;);
writer.on(&apos;finish&apos;, () =&gt; {
  console.error(&apos;All writes are now complete.&apos;);
});
</code></pre>
<h5>&apos;pipe&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_pipe" id="stream_event_pipe">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_pipe">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_pipe.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>src</code> <a href="stream.html#stream_class_stream_readable" class="type">&lt;stream.Readable&gt;</a> &#x8F93;&#x51FA;&#x5230;&#x76EE;&#x6807;&#x53EF;&#x5199;&#x6D41;&#xFF08;writable&#xFF09;&#x7684;&#x6E90;&#x6D41;&#xFF08;source stream&#xFF09;</li>
</ul>
<p>&#x5728;&#x53EF;&#x8BFB;&#x6D41;&#xFF08;readable stream&#xFF09;&#x4E0A;&#x8C03;&#x7528; <a href="#stream_readable_pipe_destination_options"><code>stream.pipe()</code></a> &#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x5728;&#x76EE;&#x6807;&#x6D41;&#x5411; (destinations) &#x4E2D;&#x6DFB;&#x52A0;&#x5F53;&#x524D;&#x53EF;&#x5199;&#x6D41; ( writable ) &#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x5728;&#x53EF;&#x5199;&#x6D41;&#x4E0A;&#x89E6;&#x53D1; <code>&apos;pipe&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<pre><code class="lang-js">const writer = getWritableStreamSomehow();
const reader = getReadableStreamSomehow();
writer.on(&apos;pipe&apos;, (src) =&gt; {
  console.error(&apos;something is piping into the writer&apos;);
  assert.equal(src, reader);
});
reader.pipe(writer);
</code></pre>
<h5>&apos;unpipe&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_unpipe" id="stream_event_unpipe">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_unpipe">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_unpipe.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>src</code> <span class="type">&lt;<a href="#stream_class_stream_readable">Readable</a> Stream&gt;</span> <a href="#stream_readable_unpipe_destination">unpiped</a> &#x5F53;&#x524D;&#x53EF;&#x5199;&#x6D41;&#x7684;&#x6E90;&#x6D41;</li>
</ul>
<p>&#x5728; <a href="#stream_class_stream_readable">Readable</a> &#x4E0A;&#x8C03;&#x7528; <a href="#stream_readable_unpipe_destination"><code>stream.unpipe()</code></a> &#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x76EE;&#x6807;&#x6D41;&#x5411;&#x4E2D;&#x79FB;&#x9664;&#x5F53;&#x524D; <a href="#stream_class_stream_writable">Writable</a> &#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;unpipe&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<pre><code class="lang-js">const writer = getWritableStreamSomehow();
const reader = getReadableStreamSomehow();
writer.on(&apos;unpipe&apos;, (src) =&gt; {
  console.error(&apos;Something has stopped piping into the writer.&apos;);
  assert.equal(src, reader);
});
reader.pipe(writer);
reader.unpipe(writer);
</code></pre>
<h5>writable.cork()<span><a class="mark" href="#stream_writable_cork" id="stream_writable_cork">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_cork">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_cork.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.11.2</span>
</div><p>&#x8C03;&#x7528; <code>writable.cork()</code> &#x65B9;&#x6CD5;&#x5C06;&#x5F3A;&#x5236;&#x6240;&#x6709;&#x5199;&#x5165;&#x6570;&#x636E;&#x90FD;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x91CC;&#x3002;
&#x76F4;&#x5230;&#x8C03;&#x7528; <a href="#stream_writable_uncork"><code>stream.uncork()</code></a> &#x6216;
<a href="#stream_writable_end_chunk_encoding_callback"><code>stream.end()</code></a> &#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x7F13;&#x51B2;&#x533A;&#x91CC;&#x7684;&#x6570;&#x636E;&#x624D;&#x4F1A;&#x88AB;&#x8F93;&#x51FA;&#x3002;</p>
<p>&#x5728;&#x5411;&#x6D41;&#x4E2D;&#x5199;&#x5165;&#x5927;&#x91CF;&#x5C0F;&#x5757;&#x6570;&#x636E;&#xFF08;small chunks of data&#xFF09;&#x65F6;&#xFF0C;&#x5185;&#x90E8;&#x7F13;&#x51B2;&#x533A;&#xFF08;internal
buffer&#xFF09;&#x53EF;&#x80FD;&#x5931;&#x6548;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x6027;&#x80FD;&#x4E0B;&#x964D;&#x3002;<code>writable.cork()</code> &#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x7528;&#x6765;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002; &#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;
&#x5B9E;&#x73B0;&#x4E86; <code>writable._writev()</code> &#x65B9;&#x6CD5;&#x7684;&#x6D41;&#x53EF;&#x4EE5;&#x5BF9;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F13;&#x51B2;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x5199;&#x5165;&#x6548;&#x7387;&#x3002;</p>
<h5>writable.end([chunk][, encoding][, callback])<span><a class="mark" href="#stream_writable_end_chunk_encoding_callback" id="stream_writable_end_chunk_encoding_callback">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_end_chunk_encoding_callback">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_end_chunk_encoding_callback.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>chunk</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> | <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <span class="type">&lt;any&gt;</span> &#x53EF;&#x9009;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x3002;&#x5BF9;&#x4E8E;&#x975E;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x6D41;&#xFF0C; <code>chunk</code> &#x5FC5;&#x987B;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x8005; <code>Buffer</code>&#x3002;&#x5BF9;&#x4E8E;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x6D41;&#xFF0C; <code>chunk</code> &#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x7684; JavaScript &#x503C;&#xFF0C;&#x9664;&#x4E86; <code>null</code>&#x3002;</li>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> &#x5982;&#x679C; <code>chunk</code> &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x7F16;&#x7801;&#x3002;</li>
<li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> &#x53EF;&#x9009;&#x7684;&#xFF0C;&#x6D41;&#x7ED3;&#x675F;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</li>
</ul>
<p>&#x8C03;&#x7528; <code>writable.end()</code> &#x65B9;&#x6CD5;&#x8868;&#x660E;&#x63A5;&#x4E0B;&#x6765;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x8981;&#x88AB;&#x5199;&#x5165; <a href="#stream_class_stream_writable">Writable</a>&#x3002;&#x901A;&#x8FC7;&#x4F20;&#x5165;&#x53EF;&#x9009;&#x7684; <code>chunk</code> &#x548C; <code>encoding</code> &#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5173;&#x95ED;&#x6D41;&#x4E4B;&#x524D;&#x518D;&#x5199;&#x5165;&#x4E00;&#x6BB5;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x4F20;&#x5165;&#x4E86;&#x53EF;&#x9009;&#x7684; <code>callback</code> &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5C06;&#x4F5C;&#x4E3A; <a href="#stream_event_finish"><code>&apos;finish&apos;</code></a> &#x4E8B;&#x4EF6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x5728;&#x8C03;&#x7528;&#x4E86; <a href="#stream_writable_end_chunk_encoding_callback"><code>stream.end()</code></a> &#x65B9;&#x6CD5;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x8C03;&#x7528; <a href="#stream_writable_write_chunk_encoding_callback"><code>stream.write()</code></a> &#x65B9;&#x6CD5;&#x5C06;&#x4F1A;&#x5BFC;&#x81F4;&#x9519;&#x8BEF;&#x3002;</p>
<pre><code class="lang-js">// &#x5199;&#x5165; &apos;hello, &apos; &#xFF0C;&#x5E76;&#x7528; &apos;world!&apos; &#x6765;&#x7ED3;&#x675F;&#x5199;&#x5165;
const file = fs.createWriteStream(&apos;example.txt&apos;);
file.write(&apos;hello, &apos;);
file.end(&apos;world!&apos;);
// &#x540E;&#x9762;&#x4E0D;&#x5141;&#x8BB8;&#x518D;&#x5199;&#x5165;&#x6570;&#x636E;&#xFF01;
</code></pre>
<h5>writable.setDefaultEncoding(encoding)<span><a class="mark" href="#stream_writable_setdefaultencoding_encoding" id="stream_writable_setdefaultencoding_encoding">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_setdefaultencoding_encoding">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_setdefaultencoding_encoding.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.11.15</span>
</div><ul>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> &#x65B0;&#x7684;&#x9ED8;&#x8BA4;&#x7F16;&#x7801;</li>
<li>&#x8FD4;&#x56DE;&#xFF1A; <code>this</code></li>
</ul>
<p><code>writable.setDefaultEncoding()</code> &#x7528;&#x4E8E;&#x4E3A; <a href="#stream_class_stream_writable">Writable</a> &#x8BBE;&#x7F6E; <code>encoding</code>&#x3002;</p>
<h5>writable.uncork()<span><a class="mark" href="#stream_writable_uncork" id="stream_writable_uncork">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_uncork">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_uncork.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.11.2</span>
</div><p><code>writable.uncork()</code> &#x5C06;&#x8F93;&#x51FA;&#x5728; <a href="#stream_writable_cork"><code>stream.cork()</code></a> &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#x7F13;&#x51B2;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F7F;&#x7528; <code>writable.cork()</code> &#x548C; <code>writable.uncork()</code> &#x6765;&#x7BA1;&#x7406;&#x5199;&#x5165;&#x7F13;&#x5B58;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; <code>process.nextTick()</code> &#x6765;&#x5EF6;&#x8FDF;&#x8C03;&#x7528; <code>writable.uncork()</code> &#x65B9;&#x6CD5;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x5355;&#x4E2A; Node.js &#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x4E2D;&#x8C03;&#x7528;&#x7684;&#x6240;&#x6709; <code>writable.write()</code> &#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x6279;&#x5904;&#x7406;&#x3002;</p>
<pre><code class="lang-js">stream.cork();
stream.write(&apos;some &apos;);
stream.write(&apos;data &apos;);
process.nextTick(() =&gt; stream.uncork());
</code></pre>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6D41;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x4E86; <code>writable.cork()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x5FC5;&#x987B;&#x8C03;&#x7528;&#x540C;&#x6837;&#x6B21;&#x6570;&#x7684; <code>writable.uncork()</code> &#x65B9;&#x6CD5;&#x4EE5;&#x8F93;&#x51FA;&#x7F13;&#x51B2;&#x533A;&#x6570;&#x636E;&#x3002;</p>
<pre><code class="lang-js">stream.cork();
stream.write(&apos;some &apos;);
stream.cork();
stream.write(&apos;data &apos;);
process.nextTick(() =&gt; {
  stream.uncork();
  // &#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x53EA;&#x6709;&#x5728; uncork() &#x88AB;&#x4E8C;&#x6B21;&#x8C03;&#x7528;&#x540E;&#x624D;&#x4F1A;&#x8F93;&#x51FA;
  stream.uncork();
});
</code></pre>
<h5>writable.write(chunk[, encoding][, callback])<span><a class="mark" href="#stream_writable_write_chunk_encoding_callback" id="stream_writable_write_chunk_encoding_callback">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_write_chunk_encoding_callback">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_write_chunk_encoding_callback.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>chunk</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> | <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> &#x8981;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;</li>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> &#x5982;&#x679C; <code>chunk</code> &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x7F16;&#x7801;</li>
<li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> &#x7F13;&#x51B2;&#x6570;&#x636E;&#x8F93;&#x51FA;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;</li>
<li>&#x8FD4;&#x56DE;&#xFF1A; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> &#x5982;&#x679C;&#x6D41;&#x9700;&#x8981;&#x7B49;&#x5F85; <code>&apos;drain&apos;</code> &#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x624D;&#x80FD;&#x7EE7;&#x7EED;&#x5199;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C06;&#x8FD4;&#x56DE; <code>false</code> &#xFF1B; &#x5426;&#x5219;&#x8FD4;&#x56DE; <code>true</code>&#x3002;</li>
</ul>
<p><code>writable.write()</code> &#x65B9;&#x6CD5;&#x5411;&#x6D41;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5728;&#x6570;&#x636E;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x540E;&#x8C03;&#x7528; <code>callback</code> &#x3002;&#x5982;&#x679C;&#x6709;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#xFF0C; <code>callback</code> <em>&#x4E0D;&#x4E00;&#x5B9A;</em> &#x4F1A;&#x63A5;&#x6536;&#x5230;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x8981;&#x786E;&#x4FDD;&#x53EF;&#x9760;&#x5730;&#x68C0;&#x6D4B;&#x5230;&#x5199;&#x5165;&#x9519;&#x8BEF;&#xFF0C;&#x5E94;&#x8BE5;&#x76D1;&#x542C;
<code>&apos;error&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<p>&#x5728;&#x786E;&#x8BA4;&#x4E86; <code>chunk</code> &#x540E;&#xFF0C;&#x5982;&#x679C;&#x5185;&#x90E8;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x6CA1;&#x6709;&#x8D85;&#x51FA;&#x521B;&#x5EFA;&#x6D41;&#x65F6;&#x8BBE;&#x5B9A;&#x7684;
<code>highWaterMark</code> &#x9608;&#x503C;&#xFF0C;&#x51FD;&#x6570;&#x5C06;&#x8FD4;&#x56DE; <code>true</code> &#x3002;
&#x5982;&#x679C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A; <code>false</code> &#xFF0C;&#x5E94;&#x8BE5;&#x505C;&#x6B62;&#x5411;&#x6D41;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x76F4;&#x5230; <a href="#stream_event_drain"><code>&apos;drain&apos;</code></a> &#x4E8B;&#x4EF6;&#x88AB;&#x89E6;&#x53D1;&#x3002;&#x7136;&#x800C;&#xFF0C;<code>false</code> &#x8FD9;&#x4E2A;&#x8FD4;&#x56DE;&#x503C;&#x53EA;&#x662F;&#x5EFA;&#x8BAE;&#x6027;&#x7684;&#xFF0C;&#x5199;&#x5165;&#x6D41;&#x4ECD;&#x5C06;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x63A5;&#x6536;&#x5E76;&#x7F13;&#x5B58; <code>chunk</code> &#x6570;&#x636E;&#xFF0C;&#x5373;&#x662F; <a href="#stream_event_drain"><code>&apos;drain&apos;</code></a> &#x4E8B;&#x4EF6;&#x8FD8;&#x6CA1;&#x6709;&#x89E6;&#x53D1;&#x3002;</p>
<p>&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x7684;&#x5199;&#x5165;&#x6D41;&#x5C06;&#x5FFD;&#x7565; <code>encoding</code> &#x53C2;&#x6570;&#x3002;</p>
<h3>&#x53EF;&#x8BFB;&#x6D41;<span><a class="mark" href="#stream_readable_streams" id="stream_readable_streams">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_streams">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_streams.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>&#x53EF;&#x8BFB;&#x6D41;&#xFF08;Readable streams&#xFF09;&#x662F;&#x5BF9;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x7684; <em>&#x6E90;&#x5934;</em> &#xFF08;source&#xFF09;&#x7684;&#x62BD;&#x8C61;&#x3002;</p>
<p>&#x53EF;&#x8BFB;&#x6D41;&#x7684;&#x4F8B;&#x5B50;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li><a href="http.html#http_class_http_incomingmessage">HTTP responses, on the client</a></li>
<li><a href="http.html#http_class_http_incomingmessage">HTTP requests, on the server</a></li>
<li><a href="fs.html#fs_class_fs_readstream">fs read streams</a></li>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
<li><a href="net.html#net_class_net_socket">TCP sockets</a></li>
<li><a href="child_process.html#child_process_child_stdout">child process stdout and stderr</a></li>
<li><a href="process.html#process_process_stdin"><code>process.stdin</code></a></li>
</ul>
<p>&#x6240;&#x6709;&#x7684; <a href="#stream_class_stream_readable">Readable</a> &#x90FD;&#x5B9E;&#x73B0;&#x4E86;
<code>stream.Readable</code> &#x7C7B;&#x5B9A;&#x4E49;&#x7684;&#x63A5;&#x53E3;&#x3002;</p>
<h4>&#x4E24;&#x79CD;&#x6A21;&#x5F0F;<span><a class="mark" href="#stream_two_modes" id="stream_two_modes">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_two_modes">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/two_modes.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>&#x53EF;&#x8BFB;&#x6D41;&#x4E8B;&#x5B9E;&#x4E0A;&#x5DE5;&#x4F5C;&#x5728;&#x4E0B;&#x9762;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x4E4B;&#x4E00;&#xFF1A;flowing &#x548C; paused &#x3002;</p>
<p>&#x5728; flowing &#x6A21;&#x5F0F;&#x4E0B;&#xFF0C; &#x53EF;&#x8BFB;&#x6D41;&#x81EA;&#x52A8;&#x4ECE;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x901A;&#x8FC7; <a href="events.html#events_class_eventemitter"><code>EventEmitter</code></a> &#x63A5;&#x53E3;&#x7684;&#x4E8B;&#x4EF6;&#x5C3D;&#x5FEB;&#x5C06;&#x6570;&#x636E;&#x63D0;&#x4F9B;&#x7ED9;&#x5E94;&#x7528;&#x3002;</p>
<p>&#x5728; paused &#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5FC5;&#x987B;&#x663E;&#x5F0F;&#x8C03;&#x7528; <a href="#stream_readable_read_size"><code>stream.read()</code></a> &#x65B9;&#x6CD5;&#x6765;&#x4ECE;&#x6D41;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x7247;&#x6BB5;&#x3002;</p>
<p>&#x6240;&#x6709;&#x521D;&#x59CB;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x4E3A; paused &#x7684; <a href="#stream_class_stream_readable">Readable</a> &#x6D41;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x9014;&#x5F84;&#x5207;&#x6362;&#x5230; flowing
&#x6A21;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x76D1;&#x542C; <a href="#stream_event_data"><code>&apos;data&apos;</code></a> &#x4E8B;&#x4EF6;&#x3002;</li>
<li>&#x8C03;&#x7528; <a href="#stream_readable_resume"><code>stream.resume()</code></a> &#x65B9;&#x6CD5;&#x3002;</li>
<li>&#x8C03;&#x7528; <a href="#stream_readable_pipe_destination_options"><code>stream.pipe()</code></a> &#x65B9;&#x6CD5;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230; <a href="#stream_class_stream_writable">Writable</a>&#x3002;</li>
</ul>
<p>&#x53EF;&#x8BFB;&#x6D41;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x9014;&#x5F84;&#x5207;&#x6362;&#x5230; paused &#x6A21;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x7BA1;&#x9053;&#x76EE;&#x6807;&#xFF08;pipe destination&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;
<a href="#stream_readable_pause"><code>stream.pause()</code></a> &#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x3002;</li>
<li>&#x5982;&#x679C;&#x5B58;&#x5728;&#x7BA1;&#x9053;&#x76EE;&#x6807;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53D6;&#x6D88; <a href="#stream_event_data"><code>&apos;data&apos;</code></a> &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#xFF0C;&#x5E76;&#x8C03;&#x7528; <a href="#stream_readable_unpipe_destination"><code>stream.unpipe()</code></a> &#x65B9;&#x6CD5;&#x79FB;&#x9664;&#x6240;&#x6709;&#x7BA1;&#x9053;&#x76EE;&#x6807;&#x6765;&#x5B9E;&#x73B0;&#x3002;</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x91CD;&#x8981;&#x6982;&#x5FF5;&#x5C31;&#x662F;&#xFF0C;&#x53EF;&#x8BFB;&#x6D41;&#x9700;&#x8981;&#x5148;&#x4E3A;&#x5176;&#x63D0;&#x4F9B;&#x6D88;&#x8D39;&#x6216;&#x5FFD;&#x7565;&#x6570;&#x636E;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x624D;&#x80FD;&#x5F00;&#x59CB;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x6D88;&#x8D39;&#x673A;&#x5236;&#x88AB;&#x7981;&#x7528;&#x6216;&#x53D6;&#x6D88;&#xFF0C;&#x53EF;&#x8BFB;&#x6D41;&#x5C06; <em>&#x5C1D;&#x8BD5;</em>
&#x505C;&#x6B62;&#x751F;&#x6210;&#x6570;&#x636E;&#x3002;</p>
<p><em>&#x6CE8;&#x610F;</em>: &#x4E3A;&#x4E86;&#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;&#x53D6;&#x6D88; <a href="#stream_event_data"><code>&apos;data&apos;</code></a> &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5E76; <strong>&#x4E0D;&#x4F1A;</strong> &#x81EA;&#x52A8;&#x5C06;&#x6D41;&#x6682;&#x505C;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7BA1;&#x9053;&#x76EE;&#x6807;&#xFF08;pipe destination&#xFF09;&#xFF0C;&#x4E14;&#x76EE;&#x6807;&#x72B6;&#x6001;&#x53D8;&#x4E3A;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x6570;&#x636E;&#xFF08;drain and ask for
more data&#xFF09;&#xFF0C;&#x8C03;&#x7528;&#x4E86; <a href="#stream_readable_pause"><code>stream.pause()</code></a> &#x65B9;&#x6CD5;&#x4E5F;&#x5E76;&#x4E0D;&#x4FDD;&#x8BC1;&#x6D41;&#x4F1A;&#x4E00;&#x76F4; <em>&#x4FDD;&#x6301;</em> &#x6682;&#x505C;&#x72B6;&#x6001;&#x3002;</p>
<p><em>&#x6CE8;&#x610F;</em>: &#x5982;&#x679C; <a href="#stream_class_stream_readable">Readable</a> &#x5207;&#x6362;&#x5230; flowing &#x6A21;&#x5F0F;&#xFF0C;&#x4E14;&#x6CA1;&#x6709;&#x6D88;&#x8D39;&#x8005;&#x5904;&#x7406;&#x6D41;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5C06;&#x4F1A;&#x4E22;&#x5931;&#x3002;
&#x6BD4;&#x5982;&#xFF0C; &#x8C03;&#x7528;&#x4E86; <code>readable.resume()</code> &#x65B9;&#x6CD5;&#x5374;&#x6CA1;&#x6709;&#x76D1;&#x542C; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x6216;&#x662F;&#x53D6;&#x6D88;&#x4E86; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#xFF0C;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;</p>
<h4>&#x4E09;&#x79CD;&#x72B6;&#x6001;<span><a class="mark" href="#stream_three_states" id="stream_three_states">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_three_states">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/three_states.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>&#x53EF;&#x8BFB;&#x6D41;&#x7684;&#x201C;&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;&#x201D;&#x662F;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x62BD;&#x8C61;&#x3002;&#x5B83;&#x62BD;&#x8C61;&#x4E86;&#x5728;&#x53EF;&#x8BFB;&#x6D41;&#x5B9E;&#x73B0;&#xFF08;Readable stream implementation&#xFF09;&#x5185;&#x90E8;&#x53D1;&#x751F;&#x7684;&#x590D;&#x6742;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5728;&#x4EFB;&#x610F;&#x65F6;&#x523B;&#xFF0C;&#x4EFB;&#x610F;&#x53EF;&#x8BFB;&#x6D41;&#x5E94;&#x786E;&#x5207;&#x5904;&#x4E8E;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x72B6;&#x6001;&#x4E4B;&#x4E00;&#xFF1A;</p>
<ul>
<li><code>readable._readableState.flowing = null</code></li>
<li><code>readable._readableState.flowing = false</code></li>
<li><code>readable._readableState.flowing = true</code></li>
</ul>
<p>&#x82E5; <code>readable._readableState.flowing</code> &#x4E3A; <code>null</code>&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x5B58;&#x5728;&#x6570;&#x636E;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x53EF;&#x8BFB;&#x6D41;&#x5C06;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x6570;&#x636E;&#x3002;</p>
<p>&#x5982;&#x679C;&#x76D1;&#x542C; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x8C03;&#x7528; <code>readable.pipe()</code>
&#x65B9;&#x6CD5;&#xFF0C;&#x6216;&#x8005;&#x8C03;&#x7528; <code>readable.resume()</code> &#x65B9;&#x6CD5;&#xFF0C;
<code>readable._readableState.flowing</code> &#x7684;&#x503C;&#x5C06;&#x4F1A;&#x53D8;&#x4E3A; <code>true</code> &#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x968F;&#x7740;&#x6570;&#x636E;&#x751F;&#x6210;&#xFF0C;&#x53EF;&#x8BFB;&#x6D41;&#x5F00;&#x59CB;&#x9891;&#x7E41;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x3002;</p>
<p>&#x8C03;&#x7528; <code>readable.pause()</code> &#x65B9;&#x6CD5;&#xFF0C; <code>readable.unpipe()</code> &#x65B9;&#x6CD5;&#xFF0C; &#x6216;&#x8005;&#x63A5;&#x6536; &#x201C;&#x80CC;&#x538B;&#x201D;&#xFF08;back pressure&#xFF09;&#xFF0C;
&#x5C06;&#x5BFC;&#x81F4; <code>readable._readableState.flowing</code> &#x503C;&#x53D8;&#x4E3A; <code>false</code>&#x3002;
&#x8FD9;&#x5C06;&#x6682;&#x505C;&#x4E8B;&#x4EF6;&#x6D41;&#xFF0C;&#x4F46; <em>&#x4E0D;&#x4F1A;</em> &#x6682;&#x505C;&#x6570;&#x636E;&#x751F;&#x6210;&#x3002;</p>
<p>&#x5F53; <code>readable._readableState.flowing</code> &#x503C;&#x4E3A; <code>false</code> &#x65F6;&#xFF0C; &#x6570;&#x636E;&#x53EF;&#x80FD;&#x5806;&#x79EF;&#x5230;&#x6D41;&#x7684;&#x5185;&#x90E8;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</p>
<h4>&#x9009;&#x62E9;&#x4E00;&#x79CD;<span><a class="mark" href="#stream_choose_one" id="stream_choose_one">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_choose_one">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/choose_one.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>&#x53EF;&#x8BFB;&#x6D41; API &#x7684;&#x6F14;&#x5316;&#x8D2F;&#x7A7F;&#x4E86;&#x591A;&#x4E2A; Node.js &#x7248;&#x672C;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x6D88;&#x8D39;&#x6D41;&#x6570;&#x636E;&#x3002;&#x901A;&#x5E38;&#x5F00;&#x53D1;&#x8005;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x5176;&#x4E2D; <em>&#x4E00;&#x79CD;</em> &#x6765;&#x6D88;&#x8D39;&#x6570;&#x636E;&#xFF0C;&#x800C; <em>&#x4E0D;&#x5E94;&#x8BE5;</em> &#x5728;&#x5355;&#x4E2A;&#x6D41;&#x4F7F;&#x7528;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x6D88;&#x8D39;&#x6570;&#x636E;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x7528;&#x6237;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; <code>readable.pipe()</code> &#x65B9;&#x6CD5;&#x6765;&#x6D88;&#x8D39;&#x6D41;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x3002;&#x5F00;&#x53D1;&#x8005;&#x5982;&#x679C;&#x8981;&#x7CBE;&#x7EC6;&#x5730;&#x63A7;&#x5236;&#x6570;&#x636E;&#x4F20;&#x9012;&#x548C;&#x4EA7;&#x751F;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <a href="events.html#events_class_eventemitter"><code>EventEmitter</code></a> &#x548C; <code>readable.pause()</code>/<code>readable.resume()</code> &#x63D0;&#x4F9B;&#x7684; API &#x3002;</p>
<h4>stream.Readable &#x7C7B;<span><a class="mark" href="#stream_class_stream_readable" id="stream_class_stream_readable">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_class_stream_readable">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/class_stream_readable.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><!--type=class-->
<h5>&apos;close&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_close_1" id="stream_event_close_1">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_close_1">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_close_1.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><p><code>&apos;close&apos;</code> &#x4E8B;&#x4EF6;&#x5C06;&#x5728;&#x6D41;&#x6216;&#x5176;&#x5E95;&#x5C42;&#x8D44;&#x6E90;&#xFF08;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF09;&#x5173;&#x95ED;&#x540E;&#x89E6;&#x53D1;&#x3002;<code>&apos;close&apos;</code> &#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x540E;&#xFF0C;&#x8BE5;&#x6D41;&#x5C06;&#x4E0D;&#x4F1A;&#x518D;&#x89E6;&#x53D1;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;&#x3002;</p>
<p>&#x4E0D;&#x662F;&#x6240;&#x6709; <a href="#stream_class_stream_readable">Readable</a> &#x90FD;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;close&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<h5>&apos;data&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_data" id="stream_event_data">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_data">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_data.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>chunk</code> <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> | <span class="type">&lt;any&gt;</span> &#x6570;&#x636E;&#x7247;&#x6BB5;&#x3002;&#x5BF9;&#x4E8E;&#x975E;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x7684;&#x53EF;&#x8BFB;&#x6D41;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x8005; <code>Buffer</code>&#x3002;
&#x5BF9;&#x4E8E;&#x5BF9;&#x8C61;&#x6A21;&#x5F0F;&#x7684;&#x53EF;&#x8BFB;&#x6D41;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x662F;&#x9664; <code>null</code> &#x4EE5;&#x5916;&#x7684;&#x4EFB;&#x610F;&#x7C7B;&#x578B; JavaScript &#x503C;&#x3002;</li>
</ul>
<p><code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#x4F1A;&#x5728;&#x6D41;&#x5C06;&#x6570;&#x636E;&#x4F20;&#x9012;&#x7ED9;&#x6D88;&#x8D39;&#x8005;&#x65F6;&#x89E6;&#x53D1;&#x3002;&#x5F53;&#x6D41;&#x8F6C;&#x6362;&#x5230; flowing &#x6A21;&#x5F0F;&#x65F6;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;&#x4E8B;&#x4EF6;&#x3002;&#x8C03;&#x7528; <code>readable.pipe()</code>&#xFF0C; <code>readable.resume()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x6216;&#x4E3A; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x5C06;&#x6D41;&#x8F6C;&#x6362;&#x5230; flowing &#x6A21;&#x5F0F;&#x3002; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#x4E5F;&#x4F1A;&#x5728;&#x8C03;&#x7528; <code>readable.read()</code> &#x65B9;&#x6CD5;&#x5E76;&#x6709;&#x6570;&#x636E;&#x8FD4;&#x56DE;&#x65F6;&#x89E6;&#x53D1;&#x3002;</p>
<p>&#x5728;&#x6CA1;&#x6709;&#x660E;&#x786E;&#x6682;&#x505C;&#x7684;&#x6D41;&#x4E0A;&#x6DFB;&#x52A0; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x4F1A;&#x5C06;&#x6D41;&#x8F6C;&#x6362;&#x4E3A; flowing &#x6A21;&#x5F0F;&#x3002; &#x6570;&#x636E;&#x4F1A;&#x5728;&#x53EF;&#x7528;&#x65F6;&#x5C3D;&#x5FEB;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E2A;&#x6D41;&#x7A0B;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8C03;&#x7528; <code>readable.setEncoding()</code> &#x65B9;&#x6CD5;&#x660E;&#x786E;&#x4E3A;&#x6D41;&#x6307;&#x5B9A;&#x4E86;&#x9ED8;&#x8BA4;&#x7F16;&#x7801;&#xFF0C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5C06;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5426;&#x5219;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5C06;&#x662F;&#x4E00;&#x4E2A;
<code>Buffer</code> &#x5B9E;&#x4F8B;&#x3002;</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
readable.on(&apos;data&apos;, (chunk) =&gt; {
  console.log(`Received ${chunk.length} bytes of data.`);
});
</code></pre>
<h5>&apos;end&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_end" id="stream_event_end">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_end">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_end.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><p><code>&apos;end&apos;</code> &#x4E8B;&#x4EF6;&#x5C06;&#x5728;&#x6D41;&#x4E2D;&#x518D;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x53EF;&#x4F9B;&#x6D88;&#x8D39;&#x65F6;&#x89E6;&#x53D1;&#x3002;</p>
<p><em>&#x6CE8;&#x610F;</em>&#xFF1A; <code>&apos;end&apos;</code> &#x4E8B;&#x4EF6;&#x53EA;&#x6709;&#x5728;&#x6570;&#x636E;&#x88AB;&#x5B8C;&#x5168;&#x6D88;&#x8D39;&#x540E; <strong>&#x624D;&#x4F1A;&#x89E6;&#x53D1;</strong> &#x3002; &#x53EF;&#x4EE5;&#x5728;&#x6570;&#x636E;&#x88AB;&#x5B8C;&#x5168;&#x6D88;&#x8D39;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x5C06;&#x6D41;&#x8F6C;&#x6362;&#x5230; 
flowing &#x6A21;&#x5F0F;&#xFF0C; &#x6216;&#x53CD;&#x590D;&#x8C03;&#x7528; <a href="#stream_readable_read_size"><code>stream.read()</code></a> &#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
readable.on(&apos;data&apos;, (chunk) =&gt; {
  console.log(`Received ${chunk.length} bytes of data.`);
});
readable.on(&apos;end&apos;, () =&gt; {
  console.log(&apos;There will be no more data.&apos;);
});
</code></pre>
<h5>&apos;error&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_error_1" id="stream_event_error_1">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_error_1">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_error_1.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a></li>
</ul>
<p><code>&apos;error&apos;</code> &#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x5728;&#x53EF;&#x8BFB;&#x6D41;&#x5B9E;&#x73B0;&#xFF08;Readable implementation&#xFF09;&#x4E0A;&#x89E6;&#x53D1;&#x3002;
&#x901A;&#x5E38;&#xFF0C;&#x8FD9;&#x4F1A;&#x5728;&#x5E95;&#x5C42;&#x7CFB;&#x7EDF;&#x5185;&#x90E8;&#x51FA;&#x9519;&#x4ECE;&#x800C;&#x4E0D;&#x80FD;&#x4EA7;&#x751F;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x5F53;&#x6D41;&#x7684;&#x5B9E;&#x73B0;&#x8BD5;&#x56FE;&#x4F20;&#x9012;&#x9519;&#x8BEF;&#x6570;&#x636E;&#x65F6;&#x53D1;&#x751F;&#x3002;</p>
<p>&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5C06;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A; <code>Error</code> &#x5BF9;&#x8C61;&#x3002;</p>
<h5>&apos;readable&apos; &#x4E8B;&#x4EF6;<span><a class="mark" href="#stream_event_readable" id="stream_event_readable">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_event_readable">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/event_readable.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><p><code>&apos;readable&apos;</code> &#x4E8B;&#x4EF6;&#x5C06;&#x5728;&#x6D41;&#x4E2D;&#x6709;&#x6570;&#x636E;&#x53EF;&#x4F9B;&#x8BFB;&#x53D6;&#x65F6;&#x89E6;&#x53D1;&#x3002;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E3A; <code>&apos;readable&apos;</code> &#x4E8B;&#x4EF6;&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x5C06;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x88AB;&#x8BFB;&#x53D6;&#x5230;&#x5185;&#x90E8;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</p>
<pre><code class="lang-javascript">const readable = getReadableStreamSomehow();
readable.on(&apos;readable&apos;, () =&gt; {
  // &#x6709;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x53EF;&#x8BFB;&#x4E86;
});
</code></pre>
<p>&#x5F53;&#x5230;&#x8FBE;&#x6D41;&#x6570;&#x636E;&#x5C3E;&#x90E8;&#x65F6;&#xFF0C; <code>&apos;readable&apos;</code> &#x4E8B;&#x4EF6;&#x4E5F;&#x4F1A;&#x89E6;&#x53D1;&#x3002;&#x89E6;&#x53D1;&#x987A;&#x5E8F;&#x5728; <code>&apos;end&apos;</code> &#x4E8B;&#x4EF6;&#x4E4B;&#x524D;&#x3002;</p>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C; <code>&apos;readable&apos;</code> &#x4E8B;&#x4EF6;&#x8868;&#x660E;&#x6D41;&#x6709;&#x4E86;&#x65B0;&#x7684;&#x52A8;&#x6001;&#xFF1A;&#x8981;&#x4E48;&#x662F;&#x6709;&#x4E86;&#x65B0;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x5230;&#x4E86;&#x6D41;&#x7684;&#x5C3E;&#x90E8;&#x3002; &#x5BF9;&#x4E8E;&#x524D;&#x8005;&#xFF0C; <a href="#stream_readable_read_size"><code>stream.read()</code></a> &#x5C06;&#x8FD4;&#x56DE;&#x53EF;&#x7528;&#x7684;&#x6570;&#x636E;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x540E;&#x8005;&#xFF0C; <a href="#stream_readable_read_size"><code>stream.read()</code></a> &#x5C06;&#x8FD4;&#x56DE;
<code>null</code>&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>foo.txt</code> &#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-js">const fs = require(&apos;fs&apos;);
const rr = fs.createReadStream(&apos;foo.txt&apos;);
rr.on(&apos;readable&apos;, () =&gt; {
  console.log(&apos;readable:&apos;, rr.read());
});
rr.on(&apos;end&apos;, () =&gt; {
  console.log(&apos;end&apos;);
});
</code></pre>
<p>&#x4E0A;&#x9762;&#x4EA4;&#x811A;&#x672C;&#x7684;&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-txt">$ node test.js
readable: null
end
</code></pre>
<p><em>&#x6CE8;&#x610F;</em>&#xFF1A; &#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C; &#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>readable.pipe()</code> &#x65B9;&#x6CD5;&#x548C; <code>&apos;data&apos;</code> &#x4E8B;&#x4EF6;&#x673A;&#x5236;&#xFF0C;&#x800C;&#x4E0D;&#x662F; <code>&apos;readable&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<h5>readable.isPaused()<span><a class="mark" href="#stream_readable_ispaused" id="stream_readable_ispaused">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_ispaused">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_ispaused.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<!--
added: v0.11.14
-->
<ul>
<li>&#x8FD4;&#x56DE;&#xFF1A; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a></li>
</ul>
<p><code>readable.isPaused()</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x53EF;&#x8BFB;&#x6D41;&#x7684;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x72B6;&#x6001;&#x3002; &#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x5728;
<code>readable.pipe()</code> &#x65B9;&#x6CD5;&#x7684;&#x5E95;&#x5C42;&#x673A;&#x5236;&#x4E2D;&#x7528;&#x5230;&#x3002;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;</p>
<pre><code class="lang-js">const readable = new stream.Readable

readable.isPaused() // === false
readable.pause()
readable.isPaused() // === true
readable.resume()
readable.isPaused() // === false
</code></pre>
<h5>readable.pause()<span><a class="mark" href="#stream_readable_pause" id="stream_readable_pause">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_pause">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_pause.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li>&#x8FD4;&#x56DE;&#xFF1A; <code>this</code></li>
</ul>
<p><code>readable.pause()</code> &#x65B9;&#x6CD5;&#x5C06;&#x4F1A;&#x4F7F; flowing &#x6A21;&#x5F0F;&#x7684;&#x6D41;&#x505C;&#x6B62;&#x89E6;&#x53D1; <a href="#stream_event_data"><code>&apos;data&apos;</code></a> &#x4E8B;&#x4EF6;&#xFF0C; &#x8FDB;&#x800C;&#x5207;&#x51FA; flowing &#x6A21;&#x5F0F;&#x3002;&#x4EFB;&#x4F55;&#x53EF;&#x7528;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5C06;&#x4FDD;&#x5B58;&#x5728;&#x5185;&#x90E8;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
readable.on(&apos;data&apos;, (chunk) =&gt; {
  console.log(`Received ${chunk.length} bytes of data.`);
  readable.pause();
  console.log(&apos;There will be no additional data for 1 second.&apos;);
  setTimeout(() =&gt; {
    console.log(&apos;Now data will start flowing again.&apos;);
    readable.resume();
  }, 1000);
});
</code></pre>
<h5>readable.pipe(destination[, options])<span><a class="mark" href="#stream_readable_pipe_destination_options" id="stream_readable_pipe_destination_options">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_pipe_destination_options">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_pipe_destination_options.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>destination</code> <a href="stream.html#stream_class_stream_writable" class="type">&lt;stream.Writable&gt;</a> &#x6570;&#x636E;&#x5199;&#x5165;&#x76EE;&#x6807;</li>
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Pipe &#x9009;&#x9879;<ul>
<li><code>end</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> &#x5728; reader &#x7ED3;&#x675F;&#x65F6;&#x7ED3;&#x675F; writer &#x3002;&#x9ED8;&#x8BA4;&#x4E3A; <code>true</code>&#x3002;</li>
</ul>
</li>
</ul>
<p><code>readable.pipe()</code> &#x7ED1;&#x5B9A;&#x4E00;&#x4E2A; <a href="#stream_class_stream_writable">Writable</a> &#x5230; <code>readable</code> &#x4E0A;&#xFF0C;
&#x5C06;&#x53EF;&#x5199;&#x6D41;&#x81EA;&#x52A8;&#x5207;&#x6362;&#x5230; flowing &#x6A21;&#x5F0F;&#x5E76;&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x4F20;&#x7ED9;&#x7ED1;&#x5B9A;&#x7684; <a href="#stream_class_stream_writable">Writable</a>&#x3002;&#x6570;&#x636E;&#x6D41;&#x5C06;&#x88AB;&#x81EA;&#x52A8;&#x7BA1;&#x7406;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x53EF;&#x8BFB;&#x6D41;&#x8F83;&#x5FEB;&#xFF0C;&#x76EE;&#x6807;&#x53EF;&#x5199;&#x6D41;&#x4E5F;&#x4E0D;&#x4F1A;&#x8D85;&#x8D1F;&#x8377;&#xFF08;overwhelmed&#xFF09;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x4F8B;&#x5B50;&#x5C06; <code>readable</code> &#x4E2D;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x4F20;&#x9012;&#x7ED9;&#x540D;&#x4E3A; <code>file.txt</code> &#x7684;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
const writable = fs.createWriteStream(&apos;file.txt&apos;);
// readable &#x4E2D;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x4F20;&#x7ED9;&#x4E86; &apos;file.txt&apos;
readable.pipe(writable);
</code></pre>
<p>&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x4E2A;&#x53EF;&#x8BFB;&#x6D41;&#x4E0A;&#x7ED1;&#x5B9A;&#x591A;&#x4E2A;&#x53EF;&#x5199;&#x6D41;&#x3002;</p>
<p><code>readable.pipe()</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE; <em>&#x76EE;&#x6807;&#x6D41;</em> &#x7684;&#x5F15;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x6D41;&#x8FDB;&#x884C;&#x94FE;&#x5F0F;&#x5730;&#x7BA1;&#x9053;&#x64CD;&#x4F5C;&#xFF1A;</p>
<pre><code class="lang-js">const r = fs.createReadStream(&apos;file.txt&apos;);
const z = zlib.createGzip();
const w = fs.createWriteStream(&apos;file.txt.gz&apos;);
r.pipe(z).pipe(w);
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F53;&#x6E90;&#x53EF;&#x8BFB;&#x6D41;&#xFF08;the source Readable stream&#xFF09;&#x89E6;&#x53D1; <a href="#stream_event_end"><code>&apos;end&apos;</code></a> &#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x76EE;&#x6807;&#x6D41;&#x4E5F;&#x4F1A;&#x8C03;&#x7528; <a href="#stream_writable_end_chunk_encoding_callback"><code>stream.end()</code></a> &#x65B9;&#x6CD5;&#x4ECE;&#x800C;&#x7ED3;&#x675F;&#x5199;&#x5165;&#x3002;&#x8981;&#x7981;&#x7528;&#x8FD9;&#x4E00;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#xFF0C; <code>end</code>
&#x9009;&#x9879;&#x5E94;&#x8BE5;&#x6307;&#x5B9A;&#x4E3A; <code>false</code>&#xFF0C; &#x8FD9;&#x5C06;&#x4F7F;&#x76EE;&#x6807;&#x6D41;&#x4FDD;&#x6301;&#x6253;&#x5F00;&#xFF0C;
&#x5982;&#x4E0B;&#x9762;&#x4F8B;&#x5B50;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-js">reader.pipe(writer, { end: false });
reader.on(&apos;end&apos;, () =&gt; {
  writer.end(&apos;Goodbye\n&apos;);
});
</code></pre>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x70B9;&#x8981;&#x8B66;&#x60D5;&#xFF0C;&#x5982;&#x679C;&#x53EF;&#x8BFB;&#x6D41;&#x5728;&#x5904;&#x7406;&#x65F6;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x76EE;&#x6807;&#x53EF;&#x5199;&#x6D41; <em>&#x4E0D;&#x4F1A;</em> &#x81EA;&#x52A8;&#x5173;&#x95ED;&#x3002;
&#x5982;&#x679C;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x9700;&#x8981; <em>&#x624B;&#x52A8;</em> &#x5173;&#x95ED;&#x6240;&#x6709;&#x6D41;&#x4EE5;&#x907F;&#x514D;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;</p>
<p><em>&#x6CE8;&#x610F;</em>&#xFF1A;&#x4E0D;&#x7BA1;&#x5BF9; <a href="process.html#process_process_stderr"><code>process.stderr</code></a> &#x548C; <a href="process.html#process_process_stdout"><code>process.stdout</code></a> &#x6307;&#x5B9A;&#x4EC0;&#x4E48;&#x9009;&#x9879;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x76F4;&#x5230; Node.js &#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x624D;&#x5173;&#x95ED;&#x3002;</p>
<h5>readable.read([size])<span><a class="mark" href="#stream_readable_read_size" id="stream_readable_read_size">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_read_size">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_read_size.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>size</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;Number&gt;</a> Optional argument to specify how much data to read.</li>
<li>Return <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> | <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type" class="type">&lt;Null&gt;</a></li>
</ul>
<p>The <code>readable.read()</code> method pulls some data out of the internal buffer and
returns it. If no data available to be read, <code>null</code> is returned. By default,
the data will be returned as a <code>Buffer</code> object unless an encoding has been
specified using the <code>readable.setEncoding()</code> method or the stream is operating
in object mode.</p>
<p>The optional <code>size</code> argument specifies a specific number of bytes to read. If
<code>size</code> bytes are not available to be read, <code>null</code> will be returned <em>unless</em>
the stream has ended, in which case all of the data remaining in the internal
buffer will be returned (<em>even if it exceeds <code>size</code> bytes</em>).</p>
<p>If the <code>size</code> argument is not specified, all of the data contained in the
internal buffer will be returned.</p>
<p>The <code>readable.read()</code> method should only be called on Readable streams operating
in paused mode. In flowing mode, <code>readable.read()</code> is called automatically until
the internal buffer is fully drained.</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
readable.on(&apos;readable&apos;, () =&gt; {
  var chunk;
  while (null !== (chunk = readable.read())) {
    console.log(`Received ${chunk.length} bytes of data.`);
  }
});
</code></pre>
<p>In general, it is recommended that developers avoid the use of the <code>&apos;readable&apos;</code>
event and the <code>readable.read()</code> method in favor of using either
<code>readable.pipe()</code> or the <code>&apos;data&apos;</code> event.</p>
<p>A Readable stream in object mode will always return a single item from
a call to <a href="#stream_readable_read_size"><code>readable.read(size)</code></a>, regardless of the value of the
<code>size</code> argument.</p>
<p><em>Note:</em> If the <code>readable.read()</code> method returns a chunk of data, a <code>&apos;data&apos;</code>
event will also be emitted.</p>
<p><em>Note</em>: Calling <a href="#stream_readable_read_size"><code>stream.read([size])</code></a> after the <a href="#stream_event_end"><code>&apos;end&apos;</code></a>
event has been emitted will return <code>null</code>. No runtime error will be raised.</p>
<h5>readable.resume()<span><a class="mark" href="#stream_readable_resume" id="stream_readable_resume">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_resume">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_resume.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li>Returns: <code>this</code></li>
</ul>
<p>The <code>readable.resume()</code> method causes an explicitly paused Readable stream to
resume emitting <a href="#stream_event_data"><code>&apos;data&apos;</code></a> events, switching the stream into flowing mode.</p>
<p>The <code>readable.resume()</code> method can be used to fully consume the data from a
stream without actually processing any of that data as illustrated in the
following example:</p>
<pre><code class="lang-js">getReadableStreamSomehow()
  .resume()
  .on(&apos;end&apos;, () =&gt; {
    console.log(&apos;Reached the end, but did not read anything.&apos;);
  });
</code></pre>
<h5>readable.setEncoding(encoding)<span><a class="mark" href="#stream_readable_setencoding_encoding" id="stream_readable_setencoding_encoding">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_setencoding_encoding">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_setencoding_encoding.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> The encoding to use.</li>
<li>Returns: <code>this</code></li>
</ul>
<p>The <code>readable.setEncoding()</code> method sets the default character encoding for
data read from the Readable stream.</p>
<p>Setting an encoding causes the stream data
to be returned as string of the specified encoding rather than as <code>Buffer</code>
objects. For instance, calling <code>readable.setEncoding(&apos;utf8&apos;)</code> will cause the
output data will be interpreted as UTF-8 data, and passed as strings. Calling
<code>readable.setEncoding(&apos;hex&apos;)</code> will cause the data to be encoded in hexadecimal
string format.</p>
<p>The Readable stream will properly handle multi-byte characters delivered through
the stream that would otherwise become improperly decoded if simply pulled from
the stream as <code>Buffer</code> objects.</p>
<p>Encoding can be disabled by calling <code>readable.setEncoding(null)</code>. This approach
is useful when working with binary data or with large multi-byte strings spread
out over multiple chunks.</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
readable.setEncoding(&apos;utf8&apos;);
readable.on(&apos;data&apos;, (chunk) =&gt; {
  assert.equal(typeof chunk, &apos;string&apos;);
  console.log(&apos;got %d characters of string data&apos;, chunk.length);
});
</code></pre>
<h5>readable.unpipe([destination])<span><a class="mark" href="#stream_readable_unpipe_destination" id="stream_readable_unpipe_destination">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_unpipe_destination">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_unpipe_destination.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>destination</code> <a href="stream.html#stream_class_stream_writable" class="type">&lt;stream.Writable&gt;</a> Optional specific stream to unpipe</li>
</ul>
<p>The <code>readable.unpipe()</code> method detaches a Writable stream previously attached
using the <a href="#stream_readable_pipe_destination_options"><code>stream.pipe()</code></a> method.</p>
<p>If the <code>destination</code> is not specified, then <em>all</em> pipes are detached.</p>
<p>If the <code>destination</code> is specified, but no pipe is set up for it, then
the method does nothing.</p>
<pre><code class="lang-js">const readable = getReadableStreamSomehow();
const writable = fs.createWriteStream(&apos;file.txt&apos;);
// All the data from readable goes into &apos;file.txt&apos;,
// but only for the first second
readable.pipe(writable);
setTimeout(() =&gt; {
  console.log(&apos;Stop writing to file.txt&apos;);
  readable.unpipe(writable);
  console.log(&apos;Manually close the file stream&apos;);
  writable.end();
}, 1000);
</code></pre>
<h5>readable.unshift(chunk)<span><a class="mark" href="#stream_readable_unshift_chunk" id="stream_readable_unshift_chunk">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_unshift_chunk">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_unshift_chunk.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.11</span>
</div><ul>
<li><code>chunk</code> <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> Chunk of data to unshift onto the read queue</li>
</ul>
<p>The <code>readable.unshift()</code> method pushes a chunk of data back into the internal
buffer. This is useful in certain situations where a stream is being consumed by
code that needs to &quot;un-consume&quot; some amount of data that it has optimistically
pulled out of the source, so that the data can be passed on to some other party.</p>
<p><em>Note</em>: The <code>stream.unshift(chunk)</code> method cannot be called after the
<a href="#stream_event_end"><code>&apos;end&apos;</code></a> event has been emitted or a runtime error will be thrown.</p>
<p>Developers using <code>stream.unshift()</code> often should consider switching to
use of a <a href="#stream_class_stream_transform">Transform</a> stream instead. See the <a href="#stream_api_for_stream_implementers">API for Stream Implementers</a>
section for more information.</p>
<pre><code class="lang-js">// Pull off a header delimited by \n\n
// use unshift() if we get too much
// Call the callback with (error, header, stream)
const StringDecoder = require(&apos;string_decoder&apos;).StringDecoder;
function parseHeader(stream, callback) {
  stream.on(&apos;error&apos;, callback);
  stream.on(&apos;readable&apos;, onReadable);
  const decoder = new StringDecoder(&apos;utf8&apos;);
  var header = &apos;&apos;;
  function onReadable() {
    var chunk;
    while (null !== (chunk = stream.read())) {
      var str = decoder.write(chunk);
      if (str.match(/\n\n/)) {
        // found the header boundary
        var split = str.split(/\n\n/);
        header += split.shift();
        const remaining = split.join(&apos;\n\n&apos;);
        const buf = Buffer.from(remaining, &apos;utf8&apos;);
        stream.removeListener(&apos;error&apos;, callback);
        // set the readable listener before unshifting
        stream.removeListener(&apos;readable&apos;, onReadable);
        if (buf.length)
          stream.unshift(buf);
        // now the body of the message can be read from the stream.
        callback(null, header, stream);
      } else {
        // still reading the header.
        header += str;
      }
    }
  }
}
</code></pre>
<p><em>Note</em>: Unlike <a href="#stream_readable_push_chunk_encoding"><code>stream.push(chunk)</code></a>, <code>stream.unshift(chunk)</code>
will not end the reading process by resetting the internal reading state of the
stream. This can cause unexpected results if <code>readable.unshift()</code> is called
during a read (i.e. from within a <a href="#stream_readable_read_size_1"><code>stream._read()</code></a>
implementation on a custom stream). Following the call to <code>readable.unshift()</code>
with an immediate <a href="#stream_readable_push_chunk_encoding"><code>stream.push(&apos;&apos;)</code></a> will reset the reading state
appropriately, however it is best to simply avoid calling <code>readable.unshift()</code>
while in the process of performing a read.</p>
<h5>readable.wrap(stream)<span><a class="mark" href="#stream_readable_wrap_stream" id="stream_readable_wrap_stream">#</a></span></h5><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_wrap_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_wrap_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><ul>
<li><code>stream</code> <a href="stream.html#stream_stream" class="type">&lt;Stream&gt;</a> An &quot;old style&quot; readable stream</li>
</ul>
<p>Versions of Node.js prior to v0.10 had streams that did not implement the
entire <code>stream</code> module API as it is currently defined. (See <a href="#stream_compatibility_with_older_node_js_versions">Compatibility</a>
for more information.)</p>
<p>When using an older Node.js library that emits <a href="#stream_event_data"><code>&apos;data&apos;</code></a> events and has a
<a href="#stream_readable_pause"><code>stream.pause()</code></a> method that is advisory only, the
<code>readable.wrap()</code> method can be used to create a <a href="#stream_class_stream_readable">Readable</a> stream that uses
the old stream as its data source.</p>
<p>It will rarely be necessary to use <code>readable.wrap()</code> but the method has been
provided as a convenience for interacting with older Node.js applications and
libraries.</p>
<p>For example:</p>
<pre><code class="lang-js">const OldReader = require(&apos;./old-api-module.js&apos;).OldReader;
const Readable = require(&apos;stream&apos;).Readable;
const oreader = new OldReader;
const myReader = new Readable().wrap(oreader);

myReader.on(&apos;readable&apos;, () =&gt; {
  myReader.read(); // etc.
});
</code></pre>
<h3>Duplex &#x6D41;&#x4E0E; Transform &#x6D41;<span><a class="mark" href="#stream_duplex_and_transform_streams" id="stream_duplex_and_transform_streams">#</a></span></h3>
<h4>stream.Duplex &#x7C7B;<span><a class="mark" href="#stream_class_stream_duplex" id="stream_class_stream_duplex">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_class_stream_duplex">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/class_stream_duplex.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><!--type=class-->
<p>Duplex &#x6D41;&#x662F;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86; <a href="#stream_class_stream_readable">Readable</a> &#x548C;
<a href="#stream_class_stream_writable">Writable</a> &#x63A5;&#x53E3;&#x7684;&#x6D41;&#x3002;</p>
<p>Duplex &#x6D41;&#x7684;&#x5B9E;&#x4F8B;&#x5305;&#x62EC;&#x4E86;&#xFF1A;</p>
<ul>
<li><a href="net.html#net_class_net_socket">TCP sockets</a></li>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
</ul>
<h4>stream.Transform &#x7C7B;<span><a class="mark" href="#stream_class_stream_transform" id="stream_class_stream_transform">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_class_stream_transform">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/class_stream_transform.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.9.4</span>
</div><!--type=class-->
<p>&#x53D8;&#x6362;&#x6D41;&#xFF08;Transform streams&#xFF09; &#x662F;&#x4E00;&#x79CD; <a href="#stream_class_stream_duplex">Duplex</a> &#x6D41;&#x3002;&#x5B83;&#x7684;&#x8F93;&#x51FA;&#x4E0E;&#x8F93;&#x5165;&#x662F;&#x901A;&#x8FC7;&#x67D0;&#x79CD;&#x65B9;&#x5F0F;&#x5173;&#x8054;&#x7684;&#x3002;&#x548C;&#x6240;&#x6709; <a href="#stream_class_stream_duplex">Duplex</a> &#x6D41;&#x4E00;&#x6837;&#xFF0C;&#x53D8;&#x6362;&#x6D41;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86; <a href="#stream_class_stream_readable">Readable</a> &#x548C; <a href="#stream_class_stream_writable">Writable</a> &#x63A5;&#x53E3;&#x3002;</p>
<p>&#x53D8;&#x6362;&#x6D41;&#x7684;&#x5B9E;&#x4F8B;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
</ul>
<h2>API for Stream Implementers<span><a class="mark" href="#stream_api_for_stream_implementers" id="stream_api_for_stream_implementers">#</a></span></h2><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_api_for_stream_implementers">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/api_for_stream_implementers.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<!--type=misc-->
<p>The <code>stream</code> module API has been designed to make it possible to easily
implement streams using JavaScript&apos;s prototypal inheritance model.</p>
<p>First, a stream developer would declare a new JavaScript class that extends one
of the four basic stream classes (<code>stream.Writable</code>, <code>stream.Readable</code>,
<code>stream.Duplex</code>, or <code>stream.Transform</code>), making sure the call the appropriate
parent class constructor:</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;

class MyWritable extends Writable {
  constructor(options) {
    super(options);
  }
}
</code></pre>
<p>The new stream class must then implement one or more specific methods, depending
on the type of stream being created, as detailed in the chart below:</p>
<table>
  <thead>
    <tr>
      <th>
        <p>Use-case</p>
      </th>
      <th>
        <p>Class</p>
      </th>
      <th>
        <p>Method(s) to implement</p>
      </th>
    </tr>
  </thead>
  <tr>
    <td>
      <p>Reading only</p>
    </td>
    <td>
      <p><a href="#stream_class_stream_readable">Readable</a></p>
    </td>
    <td>
      <p><code><a href="#stream_readable_read_size_1">_read</a></code></p>
    </td>
  </tr>
  <tr>
    <td>
      <p>Writing only</p>
    </td>
    <td>
      <p><a href="#stream_class_stream_writable">Writable</a></p>
    </td>
    <td>
      <p><code><a href="#stream_writable_write_chunk_encoding_callback_1">_write</a></code>, <code><a href="#stream_writable_writev_chunks_callback">_writev</a></code></p>
    </td>
  </tr>
  <tr>
    <td>
      <p>Reading and writing</p>
    </td>
    <td>
      <p><a href="#stream_class_stream_duplex">Duplex</a></p>
    </td>
    <td>
      <p><code><a href="#stream_readable_read_size_1">_read</a></code>, <code><a href="#stream_writable_write_chunk_encoding_callback_1">_write</a></code>, <code><a href="#stream_writable_writev_chunks_callback">_writev</a></code></p>
    </td>
  </tr>
  <tr>
    <td>
      <p>Operate on written data, then read the result</p>
    </td>
    <td>
      <p><a href="#stream_class_stream_transform">Transform</a></p>
    </td>
    <td>
      <p><code><a href="#stream_transform_transform_chunk_encoding_callback">_transform</a></code>, <code><a href="#stream_transform_flush_callback">_flush</a></code></p>
    </td>
  </tr>
</table>

<p><em>Note</em>: The implementation code for a stream should <em>never</em> call the &quot;public&quot;
methods of a stream that are intended for use by consumers (as described in
the <a href="#stream_api_for_stream_consumers">API for Stream Consumers</a> section). Doing so may lead to adverse
side effects in application code consuming the stream.</p>
<h3>Simplified Construction<span><a class="mark" href="#stream_simplified_construction" id="stream_simplified_construction">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_simplified_construction">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/simplified_construction.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>For many simple cases, it is possible to construct a stream without relying on
inheritance. This can be accomplished by directly creating instances of the
<code>stream.Writable</code>, <code>stream.Readable</code>, <code>stream.Duplex</code> or <code>stream.Transform</code>
objects and passing appropriate methods as constructor options.</p>
<p>For example:</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;

const myWritable = new Writable({
  write(chunk, encoding, callback) {
    // ...
  }
});
</code></pre>
<h3>Implementing a Writable Stream<span><a class="mark" href="#stream_implementing_a_writable_stream" id="stream_implementing_a_writable_stream">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_implementing_a_writable_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/implementing_a_writable_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>The <code>stream.Writable</code> class is extended to implement a <a href="#stream_class_stream_writable">Writable</a> stream.</p>
<p>Custom Writable streams <em>must</em> call the <code>new stream.Writable([options])</code>
constructor and implement the <code>writable._write()</code> method. The
<code>writable._writev()</code> method <em>may</em> also be implemented.</p>
<h4>Constructor: new stream.Writable([options])<span><a class="mark" href="#stream_constructor_new_stream_writable_options" id="stream_constructor_new_stream_writable_options">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_constructor_new_stream_writable_options">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/constructor_new_stream_writable_options.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a><ul>
<li><code>highWaterMark</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;Number&gt;</a> Buffer level when
<a href="#stream_writable_write_chunk_encoding_callback"><code>stream.write()</code></a> starts returning <code>false</code>. Defaults to
<code>16384</code> (16kb), or <code>16</code> for <code>objectMode</code> streams.</li>
<li><code>decodeStrings</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> Whether or not to decode strings into
Buffers before passing them to <a href="#stream_writable_write_chunk_encoding_callback_1"><code>stream._write()</code></a>.
Defaults to <code>true</code></li>
<li><code>objectMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> Whether or not the
<a href="#stream_writable_write_chunk_encoding_callback"><code>stream.write(anyObj)</code></a> is a valid operation. When set,
it becomes possible to write JavaScript values other than string or
<code>Buffer</code> if supported by the stream implementation. Defaults to <code>false</code></li>
<li><code>write</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Implementation for the
<a href="#stream_writable_write_chunk_encoding_callback_1"><code>stream._write()</code></a> method.</li>
<li><code>writev</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Implementation for the
<a href="#stream_writable_writev_chunks_callback"><code>stream._writev()</code></a> method.</li>
</ul>
</li>
</ul>
</div><p>For example:</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;

class MyWritable extends Writable {
  constructor(options) {
    // Calls the stream.Writable() constructor
    super(options);
  }
}
</code></pre>
<p>Or, when using pre-ES6 style constructors:</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;
const util = require(&apos;util&apos;);

function MyWritable(options) {
  if (!(this instanceof MyWritable))
    return new MyWritable(options);
  Writable.call(this, options);
}
util.inherits(MyWritable, Writable);
</code></pre>
<p>Or, using the Simplified Constructor approach:</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;

const myWritable = new Writable({
  write(chunk, encoding, callback) {
    // ...
  },
  writev(chunks, callback) {
    // ...
  }
});
</code></pre>
<h4>writable._write(chunk, encoding, callback)<span><a class="mark" href="#stream_writable_write_chunk_encoding_callback_1" id="stream_writable_write_chunk_encoding_callback_1">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_write_chunk_encoding_callback_1">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_write_chunk_encoding_callback_1.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>chunk</code> <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> The chunk to be written. Will <strong>always</strong>
be a buffer unless the <code>decodeStrings</code> option was set to <code>false</code>.</li>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> If the chunk is a string, then <code>encoding</code> is the
character encoding of that string. If chunk is a <code>Buffer</code>, or if the
stream is operating in object mode, <code>encoding</code> may be ignored.</li>
<li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Call this function (optionally with an error
argument) when processing is complete for the supplied chunk.</li>
</ul>
</div><p>All Writable stream implementations must provide a
<a href="#stream_writable_write_chunk_encoding_callback_1"><code>writable._write()</code></a> method to send data to the underlying
resource.</p>
<p><em>Note</em>: <a href="#stream_class_stream_transform">Transform</a> streams provide their own implementation of the
<a href="#stream_writable_write_chunk_encoding_callback_1"><code>writable._write()</code></a>.</p>
<p><em>Note</em>: <strong>This function MUST NOT be called by application code directly.</strong> It
should be implemented by child classes, and called only by the internal Writable
class methods only.</p>
<p>The <code>callback</code> method must be called to signal either that the write completed
successfully or failed with an error. The first argument passed to the
<code>callback</code> must be the <code>Error</code> object if the call failed or <code>null</code> if the
write succeeded.</p>
<p>It is important to note that all calls to <code>writable.write()</code> that occur between
the time <code>writable._write()</code> is called and the <code>callback</code> is called will cause
the written data to be buffered. Once the <code>callback</code> is invoked, the stream will
emit a <a href="#stream_event_drain"><code>&apos;drain&apos;</code></a> event. If a stream implementation is capable of processing
multiple chunks of data at once, the <code>writable._writev()</code> method should be
implemented.</p>
<p>If the <code>decodeStrings</code> property is set in the constructor options, then
<code>chunk</code> may be a string rather than a Buffer, and <code>encoding</code> will
indicate the character encoding of the string. This is to support
implementations that have an optimized handling for certain string
data encodings. If the <code>decodeStrings</code> property is explicitly set to <code>false</code>,
the <code>encoding</code> argument can be safely ignored, and <code>chunk</code> will remain the same
object that is passed to <code>.write()</code>.</p>
<p>The <code>writable._write()</code> method is prefixed with an underscore because it is
internal to the class that defines it, and should never be called directly by
user programs.</p>
<h4>writable._writev(chunks, callback)<span><a class="mark" href="#stream_writable_writev_chunks_callback" id="stream_writable_writev_chunks_callback">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_writable_writev_chunks_callback">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/writable_writev_chunks_callback.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>chunks</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> The chunks to be written. Each chunk has following
format: <code>{ chunk: ..., encoding: ... }</code>.</li>
<li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> A callback function (optionally with an error
argument) to be invoked when processing is complete for the supplied chunks.</li>
</ul>
</div><p><em>Note</em>: <strong>This function MUST NOT be called by application code directly.</strong> It
should be implemented by child classes, and called only by the internal Writable
class methods only.</p>
<p>The <code>writable._writev()</code> method may be implemented in addition to
<code>writable._write()</code> in stream implementations that are capable of processing
multiple chunks of data at once. If implemented, the method will be called with
all chunks of data currently buffered in the write queue.</p>
<p>The <code>writable._writev()</code> method is prefixed with an underscore because it is
internal to the class that defines it, and should never be called directly by
user programs.</p>
<h4>Errors While Writing<span><a class="mark" href="#stream_errors_while_writing" id="stream_errors_while_writing">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_errors_while_writing">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/errors_while_writing.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>It is recommended that errors occurring during the processing of the
<code>writable._write()</code> and <code>writable._writev()</code> methods are reported by invoking
the callback and passing the error as the first argument. This will cause an
<code>&apos;error&apos;</code> event to be emitted by the Writable. Throwing an Error from within
<code>writable._write()</code> can result in expected and inconsistent behavior depending
on how the stream is being used.  Using the callback ensures consistent and
predictable handling of errors.</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;

const myWritable = new Writable({
  write(chunk, encoding, callback) {
    if (chunk.toString().indexOf(&apos;a&apos;) &gt;= 0) {
      callback(new Error(&apos;chunk is invalid&apos;));
    } else {
      callback();
    }
  }
});
</code></pre>
<h4>An Example Writable Stream<span><a class="mark" href="#stream_an_example_writable_stream" id="stream_an_example_writable_stream">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_an_example_writable_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/an_example_writable_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>The following illustrates a rather simplistic (and somewhat pointless) custom
Writable stream implementation. While this specific Writable stream instance
is not of any real particular usefulness, the example illustrates each of the
required elements of a custom <a href="#stream_class_stream_writable">Writable</a> stream instance:</p>
<pre><code class="lang-js">const Writable = require(&apos;stream&apos;).Writable;

class MyWritable extends Writable {
  constructor(options) {
    super(options);
  }

  _write(chunk, encoding, callback) {
    if (chunk.toString().indexOf(&apos;a&apos;) &gt;= 0) {
      callback(new Error(&apos;chunk is invalid&apos;));
    } else {
      callback();
    }
  }
}
</code></pre>
<h3>Implementing a Readable Stream<span><a class="mark" href="#stream_implementing_a_readable_stream" id="stream_implementing_a_readable_stream">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_implementing_a_readable_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/implementing_a_readable_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>The <code>stream.Readable</code> class is extended to implement a <a href="#stream_class_stream_readable">Readable</a> stream.</p>
<p>Custom Readable streams <em>must</em> call the <code>new stream.Readable([options])</code>
constructor and implement the <code>readable._read()</code> method.</p>
<h4>new stream.Readable([options])<span><a class="mark" href="#stream_new_stream_readable_options" id="stream_new_stream_readable_options">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_new_stream_readable_options">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/new_stream_readable_options.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a><ul>
<li><code>highWaterMark</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;Number&gt;</a> The maximum number of bytes to store in
the internal buffer before ceasing to read from the underlying
resource. Defaults to <code>16384</code> (16kb), or <code>16</code> for <code>objectMode</code> streams</li>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> If specified, then buffers will be decoded to
strings using the specified encoding. Defaults to <code>null</code></li>
<li><code>objectMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> Whether this stream should behave
as a stream of objects. Meaning that <a href="#stream_readable_read_size"><code>stream.read(n)</code></a> returns
a single value instead of a Buffer of size n. Defaults to <code>false</code></li>
<li><code>read</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Implementation for the <a href="#stream_readable_read_size_1"><code>stream._read()</code></a>
method.</li>
</ul>
</li>
</ul>
</div><p>For example:</p>
<pre><code class="lang-js">const Readable = require(&apos;stream&apos;).Readable;

class MyReadable extends Readable {
  constructor(options) {
    // Calls the stream.Readable(options) constructor
    super(options);
  }
}
</code></pre>
<p>Or, when using pre-ES6 style constructors:</p>
<pre><code class="lang-js">const Readable = require(&apos;stream&apos;).Readable;
const util = require(&apos;util&apos;);

function MyReadable(options) {
  if (!(this instanceof MyReadable))
    return new MyReadable(options);
  Readable.call(this, options);
}
util.inherits(MyReadable, Readable);
</code></pre>
<p>Or, using the Simplified Constructor approach:</p>
<pre><code class="lang-js">const Readable = require(&apos;stream&apos;).Readable;

const myReadable = new Readable({
  read(size) {
    // ...
  }
});
</code></pre>
<h4>readable._read(size)<span><a class="mark" href="#stream_readable_read_size_1" id="stream_readable_read_size_1">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_read_size_1">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_read_size_1.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>size</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;Number&gt;</a> Number of bytes to read asynchronously</li>
</ul>
</div><p><em>Note</em>: <strong>This function MUST NOT be called by application code directly.</strong> It
should be implemented by child classes, and called only by the internal Readable
class methods only.</p>
<p>All Readable stream implementations must provide an implementation of the
<code>readable._read()</code> method to fetch data from the underlying resource.</p>
<p>When <code>readable._read()</code> is called, if data is available from the resource, the
implementation should begin pushing that data into the read queue using the
<a href="#stream_readable_push_chunk_encoding"><code>this.push(dataChunk)</code></a> method. <code>_read()</code> should continue reading
from the resource and pushing data until <code>readable.push()</code> returns <code>false</code>. Only
when <code>_read()</code> is called again after it has stopped should it resume pushing
additional data onto the queue.</p>
<p><em>Note</em>: Once the <code>readable._read()</code> method has been called, it will not be
called again until the <a href="#stream_readable_push_chunk_encoding"><code>readable.push()</code></a> method is called.</p>
<p>The <code>size</code> argument is advisory. For implementations where a &quot;read&quot; is a
single operation that returns data can use the <code>size</code> argument to determine how
much data to fetch. Other implementations may ignore this argument and simply
provide data whenever it becomes available. There is no need to &quot;wait&quot; until
<code>size</code> bytes are available before calling <a href="#stream_readable_push_chunk_encoding"><code>stream.push(chunk)</code></a>.</p>
<p>The <code>readable._read()</code> method is prefixed with an underscore because it is
internal to the class that defines it, and should never be called directly by
user programs.</p>
<h4>readable.push(chunk[, encoding])<span><a class="mark" href="#stream_readable_push_chunk_encoding" id="stream_readable_push_chunk_encoding">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_push_chunk_encoding">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_push_chunk_encoding.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>chunk</code> <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type" class="type">&lt;Null&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> Chunk of data to push into the read queue</li>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> Encoding of String chunks.  Must be a valid
Buffer encoding, such as <code>&apos;utf8&apos;</code> or <code>&apos;ascii&apos;</code></li>
<li>Returns <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> <code>true</code> if additional chunks of data may continued to be
pushed; <code>false</code> otherwise.</li>
</ul>
</div><p>When <code>chunk</code> is a <code>Buffer</code> or <code>string</code>, the <code>chunk</code> of data will be added to the
internal queue for users of the stream to consume. Passing <code>chunk</code> as <code>null</code>
signals the end of the stream (EOF), after which no more data can be written.</p>
<p>When the Readable is operating in paused mode, the data added with
<code>readable.push()</code> can be read out by calling the
<a href="#stream_readable_read_size"><code>readable.read()</code></a> method when the <a href="#stream_event_readable"><code>&apos;readable&apos;</code></a> event is
emitted.</p>
<p>When the Readable is operating in flowing mode, the data added with
<code>readable.push()</code> will be delivered by emitting a <code>&apos;data&apos;</code> event.</p>
<p>The <code>readable.push()</code> method is designed to be as flexible as possible. For
example, when wrapping a lower-level source that provides some form of
pause/resume mechanism, and a data callback, the low-level source can be wrapped
by the custom Readable instance as illustrated in the following example:</p>
<pre><code class="lang-js">// source is an object with readStop() and readStart() methods,
// and an `ondata` member that gets called when it has data, and
// an `onend` member that gets called when the data is over.

class SourceWrapper extends Readable {
  constructor(options) {
    super(options);

    this._source = getLowlevelSourceObject();

    // Every time there&apos;s data, push it into the internal buffer.
    this._source.ondata = (chunk) =&gt; {
      // if push() returns false, then stop reading from source
      if (!this.push(chunk))
        this._source.readStop();
    };

    // When the source ends, push the EOF-signaling `null` chunk
    this._source.onend = () =&gt; {
      this.push(null);
    };
  }
  // _read will be called when the stream wants to pull more data in
  // the advisory size argument is ignored in this case.
  _read(size) {
    this._source.readStart();
  }
}
</code></pre>
<p><em>Note</em>: The <code>readable.push()</code> method is intended be called only by Readable
Implementers, and only from within the <code>readable._read()</code> method.</p>
<h4>Errors While Reading<span><a class="mark" href="#stream_errors_while_reading" id="stream_errors_while_reading">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_errors_while_reading">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/errors_while_reading.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>It is recommended that errors occurring during the processing of the
<code>readable._read()</code> method are emitted using the <code>&apos;error&apos;</code> event rather than
being thrown. Throwing an Error from within <code>readable._read()</code> can result in
unexpected and inconsistent behavior depending on whether the stream is
operating in flowing or paused mode. Using the <code>&apos;error&apos;</code> event ensures
consistent and predictable handling of errors.</p>
<pre><code class="lang-js">const Readable = require(&apos;stream&apos;).Readable;

const myReadable = new Readable({
  read(size) {
    if (checkSomeErrorCondition()) {
      process.nextTick(() =&gt; this.emit(&apos;error&apos;, err));
      return;
    }
    // do some work
  }
});
</code></pre>
<h4>An Example Counting Stream<span><a class="mark" href="#stream_an_example_counting_stream" id="stream_an_example_counting_stream">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_an_example_counting_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/an_example_counting_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<!--type=example-->
<p>The following is a basic example of a Readable stream that emits the numerals
from 1 to 1,000,000 in ascending order, and then ends.</p>
<pre><code class="lang-js">const Readable = require(&apos;stream&apos;).Readable;

class Counter extends Readable {
  constructor(opt) {
    super(opt);
    this._max = 1000000;
    this._index = 1;
  }

  _read() {
    var i = this._index++;
    if (i &gt; this._max)
      this.push(null);
    else {
      var str = &apos;&apos; + i;
      var buf = Buffer.from(str, &apos;ascii&apos;);
      this.push(buf);
    }
  }
}
</code></pre>
<h3>Implementing a Duplex Stream<span><a class="mark" href="#stream_implementing_a_duplex_stream" id="stream_implementing_a_duplex_stream">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_implementing_a_duplex_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/implementing_a_duplex_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>A <a href="#stream_class_stream_duplex">Duplex</a> stream is one that implements both <a href="#stream_class_stream_readable">Readable</a> and <a href="#stream_class_stream_writable">Writable</a>,
such as a TCP socket connection.</p>
<p>Because JavaScript does not have support for multiple inheritance, the
<code>stream.Duplex</code> class is extended to implement a <a href="#stream_class_stream_duplex">Duplex</a> stream (as opposed
to extending the <code>stream.Readable</code> <em>and</em> <code>stream.Writable</code> classes).</p>
<p><em>Note</em>: The <code>stream.Duplex</code> class prototypically inherits from <code>stream.Readable</code>
and parasitically from <code>stream.Writable</code>, but <code>instanceof</code> will work properly
for both base classes due to overriding <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/hasInstance"><code>Symbol.hasInstance</code></a>
on <code>stream.Writable</code>.</p>
<p>Custom Duplex streams <em>must</em> call the <code>new stream.Duplex([options])</code>
constructor and implement <em>both</em> the <code>readable._read()</code> and
<code>writable._write()</code> methods.</p>
<h4>new stream.Duplex(options)<span><a class="mark" href="#stream_new_stream_duplex_options" id="stream_new_stream_duplex_options">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_new_stream_duplex_options">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/new_stream_duplex_options.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Passed to both Writable and Readable
constructors. Also has the following fields:<ul>
<li><code>allowHalfOpen</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> Defaults to <code>true</code>. If set to <code>false</code>, then
the stream will automatically end the readable side when the
writable side ends and vice versa.</li>
<li><code>readableObjectMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> Defaults to <code>false</code>. Sets <code>objectMode</code>
for readable side of the stream. Has no effect if <code>objectMode</code>
is <code>true</code>.</li>
<li><code>writableObjectMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;Boolean&gt;</a> Defaults to <code>false</code>. Sets <code>objectMode</code>
for writable side of the stream. Has no effect if <code>objectMode</code>
is <code>true</code>.</li>
</ul>
</li>
</ul>
</div><p>For example:</p>
<pre><code class="lang-js">const Duplex = require(&apos;stream&apos;).Duplex;

class MyDuplex extends Duplex {
  constructor(options) {
    super(options);
  }
}
</code></pre>
<p>Or, when using pre-ES6 style constructors:</p>
<pre><code class="lang-js">const Duplex = require(&apos;stream&apos;).Duplex;
const util = require(&apos;util&apos;);

function MyDuplex(options) {
  if (!(this instanceof MyDuplex))
    return new MyDuplex(options);
  Duplex.call(this, options);
}
util.inherits(MyDuplex, Duplex);
</code></pre>
<p>Or, using the Simplified Constructor approach:</p>
<pre><code class="lang-js">const Duplex = require(&apos;stream&apos;).Duplex;

const myDuplex = new Duplex({
  read(size) {
    // ...
  },
  write(chunk, encoding, callback) {
    // ...
  }
});
</code></pre>
<h4>An Example Duplex Stream<span><a class="mark" href="#stream_an_example_duplex_stream" id="stream_an_example_duplex_stream">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_an_example_duplex_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/an_example_duplex_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>The following illustrates a simple example of a Duplex stream that wraps a
hypothetical lower-level source object to which data can be written, and
from which data can be read, albeit using an API that is not compatible with
Node.js streams.
The following illustrates a simple example of a Duplex stream that buffers
incoming written data via the <a href="#stream_class_stream_writable">Writable</a> interface that is read back out
via the <a href="#stream_class_stream_readable">Readable</a> interface.</p>
<pre><code class="lang-js">const Duplex = require(&apos;stream&apos;).Duplex;
const kSource = Symbol(&apos;source&apos;);

class MyDuplex extends Duplex {
  constructor(source, options) {
    super(options);
    this[kSource] = source;
  }

  _write(chunk, encoding, callback) {
    // The underlying source only deals with strings
    if (Buffer.isBuffer(chunk))
      chunk = chunk.toString();
    this[kSource].writeSomeData(chunk);
    callback();
  }

  _read(size) {
    this[kSource].fetchSomeData(size, (data, encoding) =&gt; {
      this.push(Buffer.from(data, encoding));
    });
  }
}
</code></pre>
<p>The most important aspect of a Duplex stream is that the Readable and Writable
sides operate independently of one another despite co-existing within a single
object instance.</p>
<h4>Object Mode Duplex Streams<span><a class="mark" href="#stream_object_mode_duplex_streams" id="stream_object_mode_duplex_streams">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_object_mode_duplex_streams">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/object_mode_duplex_streams.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>For Duplex streams, <code>objectMode</code> can be set exclusively for either the Readable
or Writable side using the <code>readableObjectMode</code> and <code>writableObjectMode</code> options
respectively.</p>
<p>In the following example, for instance, a new Transform stream (which is a
type of <a href="#stream_class_stream_duplex">Duplex</a> stream) is created that has an object mode Writable side
that accepts JavaScript numbers that are converted to hexadecimal strings on
the Readable side.</p>
<pre><code class="lang-js">const Transform = require(&apos;stream&apos;).Transform;

// All Transform streams are also Duplex Streams
const myTransform = new Transform({
  writableObjectMode: true,

  transform(chunk, encoding, callback) {
    // Coerce the chunk to a number if necessary
    chunk |= 0;

    // Transform the chunk into something else.
    const data = chunk.toString(16);

    // Push the data onto the readable queue.
    callback(null, &apos;0&apos;.repeat(data.length % 2) + data);
  }
});

myTransform.setEncoding(&apos;ascii&apos;);
myTransform.on(&apos;data&apos;, (chunk) =&gt; console.log(chunk));

myTransform.write(1);
// Prints: 01
myTransform.write(10);
// Prints: 0a
myTransform.write(100);
// Prints: 64
</code></pre>
<h3>Implementing a Transform Stream<span><a class="mark" href="#stream_implementing_a_transform_stream" id="stream_implementing_a_transform_stream">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_implementing_a_transform_stream">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/implementing_a_transform_stream.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>A <a href="#stream_class_stream_transform">Transform</a> stream is a <a href="#stream_class_stream_duplex">Duplex</a> stream where the output is computed
in some way from the input. Examples include <a href="zlib.html">zlib</a> streams or <a href="crypto.html">crypto</a>
streams that compress, encrypt, or decrypt data.</p>
<p><em>Note</em>: There is no requirement that the output be the same size as the input,
the same number of chunks, or arrive at the same time. For example, a
Hash stream will only ever have a single chunk of output which is
provided when the input is ended. A <code>zlib</code> stream will produce output
that is either much smaller or much larger than its input.</p>
<p>The <code>stream.Transform</code> class is extended to implement a <a href="#stream_class_stream_transform">Transform</a> stream.</p>
<p>The <code>stream.Transform</code> class prototypically inherits from <code>stream.Duplex</code> and
implements its own versions of the <code>writable._write()</code> and <code>readable._read()</code>
methods. Custom Transform implementations <em>must</em> implement the
<a href="#stream_transform_transform_chunk_encoding_callback"><code>transform._transform()</code></a> method and <em>may</em> also implement
the <a href="#stream_transform_flush_callback"><code>transform._flush()</code></a> method.</p>
<p><em>Note</em>: Care must be taken when using Transform streams in that data written
to the stream can cause the Writable side of the stream to become paused if
the output on the Readable side is not consumed.</p>
<h4>new stream.Transform([options])<span><a class="mark" href="#stream_new_stream_transform_options" id="stream_new_stream_transform_options">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_new_stream_transform_options">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/new_stream_transform_options.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Passed to both Writable and Readable
constructors. Also has the following fields:<ul>
<li><code>transform</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Implementation for the
<a href="#stream_transform_transform_chunk_encoding_callback"><code>stream._transform()</code></a> method.</li>
<li><code>flush</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Implementation for the <a href="#stream_transform_flush_callback"><code>stream._flush()</code></a>
method.</li>
</ul>
</li>
</ul>
</div><p>For example:</p>
<pre><code class="lang-js">const Transform = require(&apos;stream&apos;).Transform;

class MyTransform extends Transform {
  constructor(options) {
    super(options);
  }
}
</code></pre>
<p>Or, when using pre-ES6 style constructors:</p>
<pre><code class="lang-js">const Transform = require(&apos;stream&apos;).Transform;
const util = require(&apos;util&apos;);

function MyTransform(options) {
  if (!(this instanceof MyTransform))
    return new MyTransform(options);
  Transform.call(this, options);
}
util.inherits(MyTransform, Transform);
</code></pre>
<p>Or, using the Simplified Constructor approach:</p>
<pre><code class="lang-js">const Transform = require(&apos;stream&apos;).Transform;

const myTransform = new Transform({
  transform(chunk, encoding, callback) {
    // ...
  }
});
</code></pre>
<h4>Events: &apos;finish&apos; and &apos;end&apos;<span><a class="mark" href="#stream_events_finish_and_end" id="stream_events_finish_and_end">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_events_finish_and_end">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/events_finish_and_end.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>The <a href="#stream_event_finish"><code>&apos;finish&apos;</code></a> and <a href="#stream_event_end"><code>&apos;end&apos;</code></a> events are from the <code>stream.Writable</code>
and <code>stream.Readable</code> classes, respectively. The <code>&apos;finish&apos;</code> event is emitted
after <a href="#stream_writable_end_chunk_encoding_callback"><code>stream.end()</code></a> is called and all chunks have been processed
by <a href="#stream_transform_transform_chunk_encoding_callback"><code>stream._transform()</code></a>. The <code>&apos;end&apos;</code> event is emitted
after all data has been output, which occurs after the callback in
<a href="#stream_transform_flush_callback"><code>transform._flush()</code></a> has been called.</p>
<h4>transform._flush(callback)<span><a class="mark" href="#stream_transform_flush_callback" id="stream_transform_flush_callback">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_transform_flush_callback">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/transform_flush_callback.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> A callback function (optionally with an error
argument) to be called when remaining data has been flushed.</li>
</ul>
</div><p><em>Note</em>: <strong>This function MUST NOT be called by application code directly.</strong> It
should be implemented by child classes, and called only by the internal Readable
class methods only.</p>
<p>In some cases, a transform operation may need to emit an additional bit of
data at the end of the stream. For example, a <code>zlib</code> compression stream will
store an amount of internal state used to optimally compress the output. When
the stream ends, however, that additional data needs to be flushed so that the
compressed data will be complete.</p>
<p>Custom <a href="#stream_class_stream_transform">Transform</a> implementations <em>may</em> implement the <code>transform._flush()</code>
method. This will be called when there is no more written data to be consumed,
but before the <a href="#stream_event_end"><code>&apos;end&apos;</code></a> event is emitted signaling the end of the
<a href="#stream_class_stream_readable">Readable</a> stream.</p>
<p>Within the <code>transform._flush()</code> implementation, the <code>readable.push()</code> method
may be called zero or more times, as appropriate. The <code>callback</code> function must
be called when the flush operation is complete.</p>
<p>The <code>transform._flush()</code> method is prefixed with an underscore because it is
internal to the class that defines it, and should never be called directly by
user programs.</p>
<h4>transform._transform(chunk, encoding, callback)<span><a class="mark" href="#stream_transform_transform_chunk_encoding_callback" id="stream_transform_transform_chunk_encoding_callback">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_transform_transform_chunk_encoding_callback">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/transform_transform_chunk_encoding_callback.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<div class="signature"><ul>
<li><code>chunk</code> <a href="buffer.html#buffer_class_buffer" class="type">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> The chunk to be transformed. Will <strong>always</strong>
be a buffer unless the <code>decodeStrings</code> option was set to <code>false</code>.</li>
<li><code>encoding</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;String&gt;</a> If the chunk is a string, then this is the
encoding type. If chunk is a buffer, then this is the special
value - &apos;buffer&apos;, ignore it in this case.</li>
<li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> A callback function (optionally with an error
argument and data) to be called after the supplied <code>chunk</code> has been
processed.</li>
</ul>
</div><p><em>Note</em>: <strong>This function MUST NOT be called by application code directly.</strong> It
should be implemented by child classes, and called only by the internal Readable
class methods only.</p>
<p>All Transform stream implementations must provide a <code>_transform()</code>
method to accept input and produce output. The <code>transform._transform()</code>
implementation handles the bytes being written, computes an output, then passes
that output off to the readable portion using the <code>readable.push()</code> method.</p>
<p>The <code>transform.push()</code> method may be called zero or more times to generate
output from a single input chunk, depending on how much is to be output
as a result of the chunk.</p>
<p>It is possible that no output is generated from any given chunk of input data.</p>
<p>The <code>callback</code> function must be called only when the current chunk is completely
consumed. The first argument passed to the <code>callback</code> must be an <code>Error</code> object
if an error occurred while processing the input or <code>null</code> otherwise. If a second
argument is passed to the <code>callback</code>, it will be forwarded on to the
<code>readable.push()</code> method. In other words the following are equivalent:</p>
<pre><code class="lang-js">transform.prototype._transform = function (data, encoding, callback) {
  this.push(data);
  callback();
};

transform.prototype._transform = function (data, encoding, callback) {
  callback(null, data);
};
</code></pre>
<p>The <code>transform._transform()</code> method is prefixed with an underscore because it
is internal to the class that defines it, and should never be called directly by
user programs.</p>
<h4>Class: stream.PassThrough<span><a class="mark" href="#stream_class_stream_passthrough" id="stream_class_stream_passthrough">#</a></span></h4><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_class_stream_passthrough">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/class_stream_passthrough.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>The <code>stream.PassThrough</code> class is a trivial implementation of a <a href="#stream_class_stream_transform">Transform</a>
stream that simply passes the input bytes across to the output. Its purpose is
primarily for examples and testing, but there are some use cases where
<code>stream.PassThrough</code> is useful as a building block for novel sorts of streams.</p>
<h2>Additional Notes<span><a class="mark" href="#stream_additional_notes" id="stream_additional_notes">#</a></span></h2>
<!--type=misc-->
<h3>Compatibility with Older Node.js Versions<span><a class="mark" href="#stream_compatibility_with_older_node_js_versions" id="stream_compatibility_with_older_node_js_versions">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_compatibility_with_older_node_js_versions">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/compatibility_with_older_node_js_versions.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<!--type=misc-->
<p>In versions of Node.js prior to v0.10, the Readable stream interface was
simpler, but also less powerful and less useful.</p>
<ul>
<li>Rather than waiting for calls the <a href="#stream_readable_read_size"><code>stream.read()</code></a> method,
<a href="#stream_event_data"><code>&apos;data&apos;</code></a> events would begin emitting immediately. Applications that
would need to perform some amount of work to decide how to handle data
were required to store read data into buffers so the data would not be lost.</li>
<li>The <a href="#stream_readable_pause"><code>stream.pause()</code></a> method was advisory, rather than
guaranteed. This meant that it was still necessary to be prepared to receive
<a href="#stream_event_data"><code>&apos;data&apos;</code></a> events <em>even when the stream was in a paused state</em>.</li>
</ul>
<p>In Node.js v0.10, the <a href="#stream_class_stream_readable">Readable</a> class was added. For backwards compatibility
with older Node.js programs, Readable streams switch into &quot;flowing mode&quot; when a
<a href="#stream_event_data"><code>&apos;data&apos;</code></a> event handler is added, or when the
<a href="#stream_readable_resume"><code>stream.resume()</code></a> method is called. The effect is that, even
when not using the new <a href="#stream_readable_read_size"><code>stream.read()</code></a> method and
<a href="#stream_event_readable"><code>&apos;readable&apos;</code></a> event, it is no longer necessary to worry about losing
<a href="#stream_event_data"><code>&apos;data&apos;</code></a> chunks.</p>
<p>While most applications will continue to function normally, this introduces an
edge case in the following conditions:</p>
<ul>
<li>No <a href="#stream_event_data"><code>&apos;data&apos;</code></a> event listener is added.</li>
<li>The <a href="#stream_readable_resume"><code>stream.resume()</code></a> method is never called.</li>
<li>The stream is not piped to any writable destination.</li>
</ul>
<p>For example, consider the following code:</p>
<pre><code class="lang-js">// WARNING!  BROKEN!
net.createServer((socket) =&gt; {

  // we add an &apos;end&apos; method, but never consume the data
  socket.on(&apos;end&apos;, () =&gt; {
    // It will never get here.
    socket.end(&apos;The message was received but was not processed.\n&apos;);
  });

}).listen(1337);
</code></pre>
<p>In versions of Node.js prior to v0.10, the incoming message data would be
simply discarded. However, in Node.js v0.10 and beyond, the socket remains
paused forever.</p>
<p>The workaround in this situation is to call the
<a href="#stream_readable_resume"><code>stream.resume()</code></a> method to begin the flow of data:</p>
<pre><code class="lang-js">// Workaround
net.createServer((socket) =&gt; {

  socket.on(&apos;end&apos;, () =&gt; {
    socket.end(&apos;The message was received but was not processed.\n&apos;);
  });

  // start the flow of data, discarding it.
  socket.resume();

}).listen(1337);
</code></pre>
<p>In addition to new Readable streams switching into flowing mode,
pre-v0.10 style streams can be wrapped in a Readable class using the
<a href="#stream_readable_wrap_stream"><code>readable.wrap()</code></a> method.</p>
<h3><code>readable.read(0)</code><span><a class="mark" href="#stream_readable_read_0" id="stream_readable_read_0">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_read_0">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_read_0.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>There are some cases where it is necessary to trigger a refresh of the
underlying readable stream mechanisms, without actually consuming any
data. In such cases, it is possible to call <code>readable.read(0)</code>, which will
always return <code>null</code>.</p>
<p>If the internal read buffer is below the <code>highWaterMark</code>, and the
stream is not currently reading, then calling <code>stream.read(0)</code> will trigger
a low-level <a href="#stream_readable_read_size_1"><code>stream._read()</code></a> call.</p>
<p>While most applications will almost never need to do this, there are
situations within Node.js where this is done, particularly in the
Readable stream class internals.</p>
<h3><code>readable.push(&apos;&apos;)</code><span><a class="mark" href="#stream_readable_push" id="stream_readable_push">#</a></span></h3><p style="font-size:12px;margin-top:-1em"><a href="/api/en/stream.html#stream_readable_push">&#x67E5;&#x770B;&#x82F1;&#x6587;&#x7248;</a> / <a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/stream/readable_push.md">&#x53C2;&#x4E0E;&#x7FFB;&#x8BD1;</a></p>
<p>Use of <code>readable.push(&apos;&apos;)</code> is not recommended.</p>
<p>Pushing a zero-byte string or <code>Buffer</code> to a stream that is not in object mode
has an interesting side effect. Because it <em>is</em> a call to
<a href="#stream_readable_push_chunk_encoding"><code>readable.push()</code></a>, the call will end the reading process.
However, because the argument is an empty string, no data is added to the
readable buffer so there is nothing for a user to consume.</p>

      </div>
    </div>
  </div>
  <script src="/static/api.js"></script>
  <script>highlight(undefined, undefined, 'pre');</script>
</body>
</html>